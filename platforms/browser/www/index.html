


<meta charset="UTF-8"/>
<link rel="stylesheet" href="http://sopromer.com/assets/map/assets/css/style.css?ver=1174948446"></link>


<script src="http://sopromer.com/assets/plugins/jQuery/jQuery-2.1.4.min.js?ver=872726261"></script>

<script src="http://sopromer.com/assets/map/assets/lib/lib.js?ver=1139897738"></script>
<script src="http://sopromer.com/assets/map/assets/configs/config.js?ver=946586514"></script>
<script src="http://sopromer.com/assets/map/assets/modules/map.js?ver=2026538944"></script>
<script src="http://sopromer.com/assets/map/assets/modules/icons.js?ver=968627238"></script>
<script src="http://sopromer.com/assets/map/assets/modules/marker.js?ver=2041955395"></script>
<script src="http://sopromer.com/assets/map/assets/modules/categories.js?ver=1463118663"></script>
<script src="http://sopromer.com/assets/map/assets/modules/htag.js?ver=1291181040"></script>
<script src="http://sopromer.com/assets/map/assets/modules/menu.js?ver=615637235"></script>
<script src="http://sopromer.com/assets/map/assets/modules/info.js?ver=797382516"></script>
<script src="http://sopromer.com/assets/map/assets/modules/delimitation.js?ver=578635125"></script>
<script src="http://sopromer.com/assets/map/assets/jquery.min.js?ver=1501737798"></script>





<link rel="stylesheet" href="http://sopromer.com/assets/refonte/map/style.css"/>
<link rel="stylesheet" href="http://sopromer.com/assets/refonte/map/map.css"/>




    <script type="text/javascript">

      var BASE_URL = "http://sopromer.com/";

    </script>

<style>













body{
	padding:0px;
	width:100%;
	overflow-x:hidden;
	overflow-y:auto;
}
.menu_presenter{
  background-color: #FFF;
box-shadow: -1px 3px 3px 0px rgba(0,0,0,0.5);
border-top-left-radius: 30px;
border-bottom-left-radius: 30px;
box-sizing: border-box;
padding: 0px 10px;
height: 50px;
line-height: 50px;
margin-top: 5px;
  font-size: 15px;
  position:relative;
  transition-duration:0.1s;
  cursor:pointer;
}
.menu_presenter_after{
  font-size: 10px;
  text-align: center;
  line-height: 300%;
  display: inline-block;
  width: 20px;
  height: 50%;
  box-shadow: 1px 1px 2px 0px rgba(0,0,0,0.9);
  position: absolute;
  top:25%;
  left:100%;
  color:#FFF;
  background-color: #BBB;
  transition-duration:0.1s;
  
}
.menu_presenter:hover{
  background-color: #EFEFEF;
box-shadow: 0px 5px 5px 0px rgba(0,0,0,0.5);
}
.menu_presenter:active{
box-shadow: 0px 1px 2px 0px rgba(0,0,0,0.5);
}
.menu_presenter.presented{
  background-color: #0F0FBC;
  color:#FFF;
}
.menu_presenter.presented:hover{
  background-color: #000077;
  color:#FFF;
}

.menu_presenter:hover .menu_presenter_after{
  font-size: 13px;
  line-height: 250%;
  width: 30px;
  height: 60%;
  top:20%;
  left:100%;
  color:#FFF;
  background-color: #777;
}






.block_m{
  display: inline-block;
width: 40px;
height: 40px;
box-shadow: 0px 0px 1px 0px rgba(0,0,0,0.5);
  font-size: 10px;
  text-align: center;
  margin: 2px;
  cursor: pointer;
  border-radius: 3px;
  vertical-align: middle;
  background-color: #FFF;
}
.block_m:hover{
box-shadow: 0px 0px 1px 1px rgba(0,0,0,0.5);
}
.block_m:active{
box-shadow: 0px 0px 0px 1px rgba(0,0,0,0.3);
}
.block_m.active{
  background-color: #AFF;
box-shadow: 0px 0px 0px 1px rgba(0,0,0,0.3);
}

.menu_mobile{
  background-color: #555;
  width: 30px;
  height: 30px;
  position: fixed;
  top:2px;
  left: 20%;
  cursor:pointer;
  transition-duration: 0.1s;
  border-radius: 3px;
}

.menu_mobile_middle,
.menu_mobile_before,
.menu_mobile_after{
  content: '';
  background-color: #FFF;
  width: 20px;
  height: 2px;
  position: absolute;
  top:7px;
  left: 5px;
  cursor:pointer;
  transition-duration:0.5s;
}
.menu_mobile_before{
  top:9px;
}

.menu_mobile_middle{
  top:14px;
}
.menu_mobile_after{
  top:19px;
}


.menu_mobile:hover .menu_mobile_middle,
.menu_mobile:hover .menu_mobile_before,
.menu_mobile:hover .menu_mobile_after{
  
  width: 22px;
  left: 4px;
}
.menu_mobile:hover .menu_mobile_before{
  top:7px;
}

.menu_mobile:hover .menu_mobile_middle{
  top:14px;
}
.menu_mobile:hover .menu_mobile_after{
  top:21px;
}




.menu_presenter .icon{
 margin: 8px 5px;
display: inline-block;
box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.3);;
border-radius: 100%;
width: 25px;
height: 25px;
padding: 4px;
}

.content_map{
  position: absolute;
top: 35px;
height: 550px;
width: 100%;
  overflow: hidden;
}
.left_block{
position: fixed;
height: 100%;
box-shadow: 2px 0px 3px 0px rgba(0,0,0,0.5);
width: 300px;
left: -302px;
top: 0px;
background-color: #FFF;
box-sizing: border-box;
padding: 10px;
}

.right_block{
  position: absolute;
height: 99%;
box-shadow: -2px 0px 3px 0px rgba(0,0,0,0.5);
width: 300px;
right: -302px;
top: 0px;
background-color: #FFF
}

.right_block_option{
  position: absolute;
top: 0px;
width: 60px;
left: -55px;
}


.left_block,
.right_block{
	transition-duration:0.5s;
}

.left_block.active{
left: 0px;
}

.right_block.active{
right: 0px;
}




.menu_mobile.active .menu_mobile_middle,
.menu_mobile.active .menu_mobile_before,
.menu_mobile.active .menu_mobile_after{
  width: 2px;
  height: 20px;
  position: absolute;
  left :7px;
  top: 5px;
  cursor:pointer;
}
.menu_mobile.active .menu_mobile_before{
  left:9px;
}

.menu_mobile.active .menu_mobile_middle{
  left :14px;
}
.menu_mobile.active .menu_mobile_after{
  left:19px;
}


.menu_mobile.active:hover .menu_mobile_middle,
.menu_mobile.active:hover .menu_mobile_before,
.menu_mobile.active:hover .menu_mobile_after{
  
  height: 22px;
  top: 4px;
}
.menu_mobile.active:hover .menu_mobile_before{
  left:7px;
}

.menu_mobile.active:hover .menu_mobile_middle{
  left: 14px;
}
.menu_mobile.active:hover .menu_mobile_after{
  left:21px;
}



.search_bar{
  display: inline-block;
box-shadow: inset 0px 0px 3px 0px rgba(0,0,0,0.5);
width: 30%;
height: 30px;
border-radius: 50px;
vertical-align: middle;
left: 30%;
position: absolute;
top: 2px;
transition-duration:0.5s;
}
.search_bar.active{
left: 25%;
width: 40%;
}
.search_bar_input{
vertical-align: middle;
padding-left: 18px;
font-size: 14px;
background: none;
border: none;width: 90%;
}
.right_option_close{
position: absolute;
right: 1px;
box-shadow: 0px 0px 5px 1px rgba(0,0,0,0.5);
display: inline-block;
width: 20px;
height: 20px;
text-align: center;
line-height: 20px;
border-radius: 100%;
cursor: pointer;
top: 10px;
	background-color:#FFF;
	color:#000;
z-index: 100;
}
.right_option_close:hover{
	background-color:#AAA;
	color:#FFF;
}
.map_title{
  display: inline-block;
vertical-align: middle;
margin: 0px 30px;
font-size: 16px;
font-weight: bold;
font-family: times;
height: 35px
}
.left_block_blocks{
  width: 100%;
height: 100px;
overflow: hidden;
position: relative;
}
.left_block_bar{
  position: absolute;
top: 6px;
right: 3px;
width: 30px;
height: 90px;
box-shadow: 0px 0px 1px 1px rgba(0,0,0,0.5);
height: 75px;
}
.left_block_up_bar{
  border: 12px solid #5e6c76;
display: inline-block;
border-top-color: rgba(0,0,0,0);
border-left-color: rgba(0,0,0,0);
border-right-color: rgba(0,0,0,0);
cursor: pointer;
position: absolute;
top: 0px;
left: 3px;
}



.left_block_down_bar{
  border: 12px solid #5e6c76;
display: inline-block;
border-bottom-color: rgba(0,0,0,0);
border-left-color: rgba(0,0,0,0);
border-right-color: rgba(0,0,0,0);
cursor: pointer;
position: absolute;
bottom: 0px;
left: 3px;
}

.left_block_list{
  width: 250px;
height: 100px;
overflow: hidden;
transition-duration:0.5s;
}


.inner_more{
  position: absolute;
border: 6px solid #FFF;
border-top-color: rgba(0,0,0,0);
border-bottom-color: rgba(0,0,0,0);
border-right-color: rgba(0,0,0,0);
top: -6px;
left: -11px;
}
.outer_more{
  position: absolute;
border: 10px solid #5e6c76;
border-top-color: rgba(0,0,0,0);
border-bottom-color: rgba(0,0,0,0);
border-right-color: rgba(0,0,0,0);
top: 25%;
left: 11px;
}
.conditionnal_line {
    position: relative;
    width: 261px;
    box-shadow: -1px 0px 2px -1px rgba(0,0,0,0.5),1px 0px 2px -1px rgba(0,0,0,0.5);
    height: 50px;
    left: 1%;
    margin: 1px 0px;
    border-radius: 0px;
    font-size: 16px;
    background-color: #FFF;
    cursor: pointer;
}
.conditionnal_line:hover {
    box-shadow: -1px 0px 3px -1px rgba(0,0,0,0.5),1px 0px 3px -1px rgba(0,0,0,0.5);
    background-color: #0F0FBC;
}

.conditionnal_line:hover .outer_more{
border: 10px solid #DDD;
border-top-color: rgba(0,0,0,0);
border-bottom-color: rgba(0,0,0,0);
border-right-color: rgba(0,0,0,0);
}
.conditionnal_line:hover .inner_more{
border: 6px solid #0F0FBC;
border-top-color: rgba(0,0,0,0);
border-bottom-color: rgba(0,0,0,0);
border-right-color: rgba(0,0,0,0);
}

.conditionnal_line_content{
	position: absolute;
	top: 20%;
	left: 37px;
	width: 70%;
	height: 70%;
	overflow: hidden;
	color: #5e6c76;
}

.conditionnal_line:hover .conditionnal_line_content{
    color:#DDD;
}
.conditionnal_lines {
    position: absolute;
	width: 100%;
	height: 98%;
	left: 0%;
	padding-top: 50px;
	box-sizing: border-box;
	overflow-y: auto;
	overflow-x: hidden;
	display: none;
	padding-left: 15%;
}
.conditionnal_lines.active{
display:block;
}

.inner_conditionnal{
	position: relative;
	left: 4px;
	border-left: 7px solid #5e6c76;
	padding: 2px 5px;
	background-color: #000;
	font-size: 13px;
	width: 235px;
	border-bottom: 1px solid #5e6c76;
	border-right: 1px solid #5e6c76;
	color: #DDD;
	line-height: 35px;
}

.inner_conditionnals{
	max-height: 0px;
	overflow-y: auto;
	overflow-x: hidden;
	transition-duration: 0.2s;
	transition-delay:0s;
}
.inner_conditionnals.active{
	max-height: 700px;
	transition-duration: 1s;
	transition-delay:0s;
}
.v_align{
  display: inline-block;
  width: 0px;
  height: 100%;
  vertical-align: middle;
}
.block_img{
	vertical-align: middle;
}
.little_img{
	width: 30px;
	height: 30px;
}

.bulle{
	display:none;
}

.bulle.active{
	display:block;
	z-index: 3000;
	position: absolute;
	background-color: rgba(0,0,0,0.8);
	color: #FFF;
	min-width: 100px;
	min-height: 30px;
	box-sizing: border-box;
	padding: 10px;
	vertical-align: middle;
	line-height: initial;
	border-radius: 7px;
	box-shadow: 0px 0px 10px 0px rgba(255,255,255,0.7),0px 0px 10px 2px rgba(0,0,0,0.7);
	cursor: pointer;
	font-size:10px;
}
.bulle.active:before{
	content:"";
	z-index: 3000;
	position: absolute;
	border:5px solid rgba(0,0,0,0.8);
	border-bottom:5px solid rgba(0,0,0,0);
	border-right:5px solid rgba(0,0,0,0);
	top: 100%;
	cursor: pointer;
}
.bulle_bottom.active:before{
	border:5px solid rgba(0,0,0,0.8);
	border-top:5px solid rgba(0,0,0,0);
	border-left:5px solid rgba(0,0,0,0);
	top: initial;
	bottom: 100%;
}
.bulle_right.active:before{
	border:5px solid rgba(0,0,0,0.8);
	border-bottom:5px solid rgba(0,0,0,0);
	border-left:5px solid rgba(0,0,0,0);
	right:10%;
}
.bulle_bottom.active.bulle_right.active:before{
	border:5px solid rgba(0,0,0,0.8);
	border-top:5px solid rgba(0,0,0,0);
	border-left:5px solid rgba(0,0,0,0);
	right:10%;
}

.templates{
	display:none;
}
.inputs label{
  display: inline-block;
  width: 60px;
  font-size: 12px;
}
.inputs input:not([type]),
.inputs input[type="text"],
.inputs input[type="file"],
.inputs select{
  border: 1px solid #DDD;
  margin: 2px;
  padding: 10px;
  box-sizing: border-box;
  box-shadow: inset 0px 0px 1px 0px rgba(0,0,0,0.3);
  border-radius: 5px;
  width: 150px;
  transition-duration: 0.5s;
  font-size: 12px;
}
.inputs input:not([type]):focus,
.inputs input[type="text"]:focus,
.inputs input[type="file"]:focus,
.inputs select:focus{
  box-shadow: inset 0px 0px 1px 0px rgba(0,0,255,1);
  background-color: #DDD;
}

.button_b{
	background-color: #DDD;
	padding: 10px;
	box-sizing: border-box;
	width: 200px;
	font-size: 14px;
	text-align: center;
	margin: 10px;
	border-radius: 5px;
	box-shadow: 0px 2px 2px 0px rgba(0,0,0,0.5);
	cursor: pointer;
	transition-duration:0.5s;
}
.button_b:hover{
	background-color: #00A;
	color:#FFF;
	box-shadow: 0px 2px 3px 1px rgba(0,0,0,0.5);
}
.button_b:active{
	background-color: #007;
	color:#FFF;
	box-shadow: 0px 1px 1px 1px rgba(0,0,0,0.5);
}
.inputs input.input_label{
  width:60px !important;
  padding-left: 2px;
  margin: 0px;
}

.b_little{
  width: 100px;
}
.inputs{
  text-align: center;
}
.button_b{
  display: inline-block;
}

.inputs input[type="file"]{
  opacity:0;
  cursor:pointer;
  z-index:1000;
  position:relative;
}
.file_mime{
	position:absolute;
	z-index:900;
	border:1px solid #DDD;
	border-radius:3px;
	font-size:12px;
	overflow:hidden;
	text-align:center;
}
.file_mime img{
	position: absolute;
	top: 0px;
	max-height: 100%;
	max-width: 100%;
	left: 0px;
	z-index: 0;
}
.file_mime span{
	position: relative;
	z-index: 1;
}

.select_virtual{
	position:absolute;
  background-color: #FFF;
  border: 1px solid #DDD;
  margin: 2px;
  padding: 0px;
  box-sizing: border-box;
  
  width: 150px;
  transition-duration: 0s;
  font-size: 12px;
  overflow: hidden;
  height:41px;
}
.select_virtual div{
  border-bottom: 1px solid #DDD;
  padding: 10px;
  cursor: pointer;
}
.select_virtual div:hover{
  background-color: #00C;
  color:#FFF;
}
.virtual_select_span{
	display: inline-block;
	height: 149px;
	overflow: auto;
	width: 100%;
	text-align: left;
}
.select_virtual.display{
	height:201px;
}
.map_element{
	display:inline-block;
	width:100%;
	height:100%;
}
.inputs.content_info>div{
  border-bottom: 1px solid #AAA;
  padding-bottom: 10px;
}
.data_var_info{
	display: inline-block;
	width: 150px;
	font-size: 10px;
	word-wrap: break-word;
	padding: 10px;
	color: #555;
	font-weight: bold;
}

.img_presentation_info{
	max-width: 100px;
	max-height: 100px;
}
.block_m.little_img .block_img{
  max-width: 25px;
  max-height: 25px;
}
.block_m.menu_categ img{
	max-width:25px;
	max-height:25px;
}
.virtual_select_span img{
	max-height:25px;
	max-height:25px;
}

@media (max-width:980px){
 .menu_mobile {
    left: 40%;
  }
  .search_bar {
   left: 60%;
  }
  .search_bar.active {
   left: 50%;
    width: 50%;
  }
  .search_bar_input {
    vertical-align: middle;
    padding-left: 18px;
    font-size: 10px;
    background: none;
    border: none;
    width: 70%;
  }
  .content_map {
    max-height:93%;
}
  .categories_menu{
    max-width: 80%;
  }
  
}
@media (max-width:980px and min-width:370px){

  .right_block {
    max-width: 80%;
    right: -80%;
}
  .left_block {
    max-width: 80%;
}
}
@media (max-width:980px){
.select_virtual,.file_mime{
  display: none;
}
  }


@media (max-width:360px){
.left_block{
  max-width:75%;
}
  }
  
.categories_menu{
position:absolute;
max-width:80%;
}
.left_block_blocks{
overflow:hidden;
}
</style>

<style id="ibl">

.categories_menu{
	top:0px;
	
}
</style>












<body><div style="box-shadow: 0 2px 3px 0px rgba(0,0,0,0.5);display: block;width: 100%;height: 35px;margin: auto;box-sizing: border-box;position: absolute;z-index: 200;background-color: #FFF;">
  <div class="map_title">Mada Map</div>
<div class="menu_mobile"  data-bulle="Menu du map">
  <div class="menu_mobile_before"></div>
  <div class="menu_mobile_middle"></div>
  <div class="menu_mobile_after"></div>
</div>
  <div class="search_bar" data-bulle="Faire des recherches">
<img src="http://sopromer.com/assets/refonte/icons/search.png" style="width: 21px;position: relative;top: 0px;left: 7px;vertical-align: middle;">
  <input class="search_bar_input" placeholder="Search with a keyword">
</div>
</div>
<div class="content_map">
	<div class="map_element"></div>
  <div class="left_block">
  <div class="map_title">Mada Map</div>
  <div class="left_block_blocks">
  
  
  <div class="left_block_list">
  <div class="left_block_bar"><div class="left_block_up_bar"></div>
 <div class="left_block_down_bar"></div></div>
  
  <div class="categories_menu"></div>
    
  </div>
</div>


</div>
  <div class="right_block">
	<div class="right_option_close">&times;</div>
	<div data-name="add_element" class="conditionnal_lines">
	<div class="conditionnal_line_container">
		<div class="conditionnal_line">
			<div class="outer_more">
				<div class="inner_more"></div>
			</div>
			<div class="conditionnal_line_content">Add element</div>
		</div>
		<div class="inner_conditionnals categories_element_create"></div>
	</div>
	<div class="conditionnal_line_container">
		<div class="conditionnal_line">
			<div class="outer_more">
				<div class="inner_more"></div>
			</div>
			<div class="conditionnal_line_content">Add surface</div>
		</div>
	</div>
	<div class="conditionnal_line_container">
		<div class="conditionnal_line">
			<div class="outer_more">
				<div class="inner_more"></div>
			</div>
			<div class="conditionnal_line_content">Customize view</div>
		</div>
	</div>
	<div class="conditionnal_line_container">
		<div class="conditionnal_line">
			<div class="outer_more">
				<div class="inner_more"></div>
			</div>
			<div class="conditionnal_line_content">General config</div>
		</div>
	</div>
</div>

	<div data-name="informations" class="conditionnal_lines">Informations</div>

  <div class="right_block_option">
    <div data-bulle="Données de configuration" class="menu_presenter presented" style=""><img src="http://sopromer.com/assets/refonte/icons/config.png" class="icon">
  <div class="menu_presenter_after">4</div></div>
  <div data-bulle="Informations" class="menu_presenter"><img src="http://sopromer.com/assets/refonte/icons/info.png" class="icon">
  <div class="menu_presenter_after"></div></div>
  <div data-bulle="Options de vues" class="menu_presenter"><img src="http://sopromer.com/assets/refonte/icons/view.png" class="icon">
  <div class="menu_presenter_after">6</div></div>







    
    
  </div>
</div>
</div>
</div>



<div class="templates">
	<div class="create_map_point" data-script="create_map_point">
		<div class="inputs content_info">
		   <div>
			 <label>Image</label>
		  <input data-text="Selectionner un fichier" type="file" placeholder="Play ground image" data-valued="true" data-value="pgimg">
		   </div>
		   <div>
			 <label>Nom Officiel</label>
		  <input data-valued="true" placeholder="Nom officiel" data-value="nom_officiel">
		   </div>
		   <div>
			 <label>Icone de la categorie</label>
		 <input data-text="Selectionner un fichier" type="file" placeholder="Categ icon" data-valued="true" data-value="categorie_icon">
		   </div>
		   <div>
			 <label>Categorie</label>
				<select class="categorie_select" data-valued="true" placeholder="Categorie" data-value="categorie">
				</select>
		   </div>
		   <div>
			 <label>Localisation gps</label>
			<input data-valued="true" placeholder="Localisation gps" data-value="localisation_gps">
		   </div>
		   <div>
			 <label>Localisation pratique</label>
			<input data-valued="true" placeholder="Localisation pratique" data-value="localisation_pratique">
		   </div>
		   <div>
			 <label>Nom Connu</label>
		  <input data-valued="true" placeholder="Nom connu" data-value="nom_connu">
		   </div>
		   <div>
			 <label>Est un point de repère</label>
			 <select data-valued="true"  data-value="repere">
				<option value="oui">oui</option>
				<option value="non">non</option>
			 </select>
		   </div>
		   <div>
			 <label>Sous Categorie</label>
			<input data-valued="true" placeholder="Sous categorie" data-value="sous_categorie">
		   </div>
		   <div>
			 <label>Quartier</label>
			<input data-valued="true" placeholder="Quartier" data-value="quartier">
		   </div>
		   <div>
			 <label>Adresse</label>
			<input data-valued="true" placeholder="Adresse" data-value="adresse">
		   </div>
		   <div>
			 <label>Acces</label>
			<input data-valued="true" placeholder="Acces" data-value="acces">
		   </div>
		   <div>
			 <label>Possibilite de parking</label>
			 <select data-valued="true" placeholder="Possibilite de parking"  data-value="possibilite_de_parking">
				<option value="oui">oui</option>
				<option value="non">non</option>
			 </select>
		   </div>
		   <div>
			 <label>Endroit connus tres proche</label>
			<input data-valued="true" placeholder="Endroit connus tres proche" data-value="endroit_connus_tres_proche">
		   </div>
		   <div>
			 <label>Jours ouverture</label>
			<input data-valued="true" placeholder="Jours ouverture" data-value="jours_ouverture">
		   </div>
		   <div>
			 <label>Horaires</label>
			<input data-valued="true" placeholder="Horaires" data-value="horaires">
		   </div>
		   <div>
			 <label>Surface</label>
			<input data-valued="true" placeholder="Surface" data-value="surface">
		   </div>
		   <div>
			 <label>Acces net mail fb site</label>
			<input data-valued="true" placeholder="Acces net mail fb site" data-value="acces_net_mail_fb_site">
		   </div>
		   <div>
			 <label>Tel qui marche</label>
			<input data-valued="true" placeholder="Tel qui marche" data-value="tel_qui_marche">
		   </div>
		   <div>
			 <label>Produits plus</label>
			<input data-valued="true" placeholder="Produits plus" data-value="produits_plus">
		   </div>
		   <div>
			 <label>Ex prix</label>
			<input data-valued="true" placeholder="Ex prix" data-value="ex_prix">
		   </div>
		   <div>
			 <label>Usp</label>
			<input data-valued="true" placeholder="Usp" data-value="usp">
		   </div>
		   <div>
			 <label>Annee d'ouverture</label>
			<input data-valued="true" placeholder="Annee d'ouverture" data-value="annee_ouverture">
		   </div>
		   <div>
			 <label>Donnees specifiques</label>
			<input data-valued="true" placeholder="Donnees specifiques" data-value="donnees_specifiques">
		   </div>
		   	
			
			
		   
		   
		   
		   
		   
		</div>
		<div class="inputs">
		   <div class="button_b add_field">Add field</div>
		   <div class="button_b add_image">Add image</div>
		</div><div class="inputs">
		   <div class="button_b b_little action_edit">Create</div><div class="button_b b_little action_cancel">Cancel</div>
		</div>
	</div>
	<div class="create_map_point_coord" data-script="create_map_point_coord">
		<div class="inputs content_info">
			
		   <div>
			 
			<div class="button_b edit_coords">Edit coords</div>
		   </div>
		   <div>
			 <label>Image</label>
		  <input data-text="Selectionner un fichier" type="file" placeholder="Play ground image" data-valued="true" data-value="pgimg">
		   </div>
		   <div>
			 <label>Nom Officiel</label>
		  <input data-valued="true" placeholder="Nom officiel" data-value="nom_officiel">
		   </div>
		   <div>
			 <label>Icone de la categorie</label>
		 <input data-text="Selectionner un fichier" type="file" placeholder="Categ icon" data-valued="true" data-value="categorie_icon">
		   </div>
		   <div>
			 <label>Categorie</label>
				<select class="categorie_select" data-valued="true" placeholder="Categorie" data-value="categorie">
				</select>
		   </div>
		   <div>
			 <label>Localisation gps</label>
			<input data-valued="true" placeholder="Localisation gps" data-value="localisation_gps">
		   </div>
		   <div>
			 <label>Localisation pratique</label>
			<input data-valued="true" placeholder="Localisation pratique" data-value="localisation_pratique">
		   </div>
		   <div>
			 <label>Nom Connu</label>
		  <input data-valued="true" placeholder="Nom connu" data-value="nom_connu">
		   </div>
		   <div>
			 <label>Est un point de repère</label>
			 <select data-valued="true"  data-value="repere">
				<option value="oui">oui</option>
				<option value="non">non</option>
			 </select>
		   </div>
		   <div>
			 <label>Sous Categorie</label>
			<input data-valued="true" placeholder="Sous categorie" data-value="sous_categorie">
		   </div>
		   <div>
			 <label>Quartier</label>
			<input data-valued="true" placeholder="Quartier" data-value="quartier">
		   </div>
		   <div>
			 <label>Adresse</label>
			<input data-valued="true" placeholder="Adresse" data-value="adresse">
		   </div>
		   <div>
			 <label>Acces</label>
			<input data-valued="true" placeholder="Acces" data-value="acces">
		   </div>
		   <div>
			 <label>Possibilite de parking</label>
			 <select data-valued="true" placeholder="Possibilite de parking"  data-value="possibilite_de_parking">
				<option value="oui">oui</option>
				<option value="non">non</option>
			 </select>
		   </div>
		   <div>
			 <label>Endroit connus tres proche</label>
			<input data-valued="true" placeholder="Endroit connus tres proche" data-value="endroit_connus_tres_proche">
		   </div>
		   <div>
			 <label>Jours ouverture</label>
			<input data-valued="true" placeholder="Jours ouverture" data-value="jours_ouverture">
		   </div>
		   <div>
			 <label>Horaires</label>
			<input data-valued="true" placeholder="Horaires" data-value="horaires">
		   </div>
		   <div>
			 <label>Surface</label>
			<input data-valued="true" placeholder="Surface" data-value="surface">
		   </div>
		   <div>
			 <label>Acces net mail fb site</label>
			<input data-valued="true" placeholder="Acces net mail fb site" data-value="acces_net_mail_fb_site">
		   </div>
		   <div>
			 <label>Tel qui marche</label>
			<input data-valued="true" placeholder="Tel qui marche" data-value="tel_qui_marche">
		   </div>
		   <div>
			 <label>Produits plus</label>
			<input data-valued="true" placeholder="Produits plus" data-value="produits_plus">
		   </div>
		   <div>
			 <label>Ex prix</label>
			<input data-valued="true" placeholder="Ex prix" data-value="ex_prix">
		   </div>
		   <div>
			 <label>Usp</label>
			<input data-valued="true" placeholder="Usp" data-value="usp">
		   </div>
		   <div>
			 <label>Annee d'ouverture</label>
			<input data-valued="true" placeholder="Annee d'ouverture" data-value="annee_ouverture">
		   </div>
		   <div>
			 <label>Donnees specifiques</label>
			<input data-valued="true" placeholder="Donnees specifiques" data-value="donnees_specifiques">
		   </div>
		   	
			
			
		   
		   
		   
		   
		   
		</div>
		<div class="inputs">
		   <div class="button_b add_field">Add field</div>
		   <div class="button_b add_image">Add image</div>
		</div><div class="inputs">
		   <div class="button_b b_little action_edit">Create</div><div class="button_b b_little action_cancel">Cancel</div>
		</div>
	</div>
	<div class="edit_map_point" data-script="edit_map_point">
		<div class="inputs content_info">
		  <input type="hidden" data-valued="true" data-value="id">
		   <div>
			 <label>Image</label>
		  <input data-text="Selectionner un fichier" type="file" placeholder="Play ground image" data-valued="true" data-value="pgimg">
		   </div>
		   <div>
			 <label>Nom Officiel</label>
		  <input data-valued="true" placeholder="Nom Officiel" data-value="nom_officiel">
		   </div>
		   <div>
			 <label>Categorie</label>
				<select class="categorie_select_id" data-valued="true" placeholder="Categorie" data-value="categorie">
				</select>
		   </div>
		   <div>
			 <label>Localisation gps</label>
			<input data-valued="true" placeholder="Localisation gps" data-value="localisation_gps">
		   </div>
		   <div>
			 <label>Localisation pratique</label>
			<input data-valued="true" placeholder="Localisation pratique" data-value="localisation_pratique">
		   </div>
		   <div>
			 <label>Nom Connu</label>
		  <input data-valued="true" placeholder="Nom Connu" data-value="nom_connu">
		   </div>
		   <div>
			 <label>Est un point de repère</label>
			 <select data-valued="true"  data-value="repere">
				<option value="1">oui</option>
				<option value="0">non</option>
			 </select>
		   </div>
		   <div>
			 <label>Sous Categorie</label>
			<input data-valued="true" placeholder="Sous categorie" data-value="sous_categorie">
		   </div>
		   <div>
			 <label>Quartier</label>
			<input data-valued="true" placeholder="Quartier" data-value="quartier">
		   </div>
		   <div>
			 <label>Adresse</label>
			<input data-valued="true" placeholder="Adresse" data-value="adresse">
		   </div>
		   <div>
			 <label>Acces</label>
			<input data-valued="true" placeholder="Acces" data-value="acces">
		   </div>
		   <div>
			 <label>Possibilite de parking</label>
			 <select data-valued="true" placeholder="Possibilite de parking"  data-value="possibilite_de_parking">
				<option value="1">oui</option>
				<option value="0">non</option>
			 </select>
		   </div>
		   <div>
			 <label>Endroit connus tres proche</label>
			<input data-valued="true" placeholder="Endroit connus tres proche" data-value="endroit_connus_tres_proche">
		   </div>
		   <div>
			 <label>Jours ouverture</label>
			<input data-valued="true" placeholder="Jours ouverture" data-value="jours_ouverture">
		   </div>
		   <div>
			 <label>Horaires</label>
			<input data-valued="true" placeholder="Horaires" data-value="horaires">
		   </div>
		   <div>
			 <label>Surface</label>
			<input data-valued="true" placeholder="Surface" data-value="surface">
		   </div>
		   <div>
			 <label>Acces net mail fb site</label>
			<input data-valued="true" placeholder="Acces net mail fb site" data-value="acces_net_mail_fb_site">
		   </div>
		   <div>
			 <label>Tel qui marche</label>
			<input data-valued="true" placeholder="Tel qui marche" data-value="tel_qui_marche">
		   </div>
		   <div>
			 <label>Produits plus</label>
			<input data-valued="true" placeholder="Produits plus" data-value="produits_plus">
		   </div>
		   <div>
			 <label>Ex prix</label>
			<input data-valued="true" placeholder="Ex prix" data-value="ex_prix">
		   </div>
		   <div>
			 <label>Usp</label>
			<input data-valued="true" placeholder="Usp" data-value="usp">
		   </div>
		   <div>
			 <label>Annee d'ouverture</label>
			<input data-valued="true" placeholder="Annee d'ouverture" data-value="annee_ouverture">
		   </div>
		   <div>
			 <label>Donnees specifiques</label>
			<input data-valued="true" placeholder="Donnees specifiques" data-value="donnees_specifiques">
		   </div>
		   	
			
			
		   
		   
		   
		   
		   
		</div>
		<div class="inputs">
		   <div class="button_b add_field">Add field</div>
		   <div class="button_b add_image">Add image</div>
		</div><div class="inputs">
		   <div class="button_b b_little action_edit">Edit</div><div class="button_b b_little action_cancel">Cancel</div>
		</div>
	</div>
	<div class="edit_map_point_coord" data-script="edit_map_point_coord">
		<div class="inputs content_info">
		   <div>
			 
			<div class="button_b edit_coords">Edit coords</div>
		   </div>
		  <input type="hidden" data-valued="true" data-value="id">
		   <div>
			 <label>Image</label>
		  <input data-text="Selectionner un fichier" type="file" placeholder="Play ground image" data-valued="true" data-value="pgimg">
		   </div>
		   <div>
			 <label>Nom Officiel</label>
		  <input data-valued="true" placeholder="Nom Officiel" data-value="nom_officiel">
		   </div>
		   <div>
			 <label>Categorie</label>
				<select class="categorie_select_id" data-valued="true" placeholder="Categorie" data-value="categorie">
				</select>
		   </div>
		   <div>
			 <label>Localisation gps</label>
			<input data-valued="true" placeholder="Localisation gps" data-value="localisation_gps">
		   </div>
		   <div>
			 <label>Localisation pratique</label>
			<input data-valued="true" placeholder="Localisation pratique" data-value="localisation_pratique">
		   </div>
		   <div>
			 <label>Nom Connu</label>
		  <input data-valued="true" placeholder="Nom Connu" data-value="nom_connu">
		   </div>
		   <div>
			 <label>Est un point de repère</label>
			 <select data-valued="true"  data-value="repere">
				<option value="1">oui</option>
				<option value="0">non</option>
			 </select>
		   </div>
		   <div>
			 <label>Sous Categorie</label>
			<input data-valued="true" placeholder="Sous categorie" data-value="sous_categorie">
		   </div>
		   <div>
			 <label>Quartier</label>
			<input data-valued="true" placeholder="Quartier" data-value="quartier">
		   </div>
		   <div>
			 <label>Adresse</label>
			<input data-valued="true" placeholder="Adresse" data-value="adresse">
		   </div>
		   <div>
			 <label>Acces</label>
			<input data-valued="true" placeholder="Acces" data-value="acces">
		   </div>
		   <div>
			 <label>Possibilite de parking</label>
			 <select data-valued="true" placeholder="Possibilite de parking"  data-value="possibilite_de_parking">
				<option value="1">oui</option>
				<option value="0">non</option>
			 </select>
		   </div>
		   <div>
			 <label>Endroit connus tres proche</label>
			<input data-valued="true" placeholder="Endroit connus tres proche" data-value="endroit_connus_tres_proche">
		   </div>
		   <div>
			 <label>Jours ouverture</label>
			<input data-valued="true" placeholder="Jours ouverture" data-value="jours_ouverture">
		   </div>
		   <div>
			 <label>Horaires</label>
			<input data-valued="true" placeholder="Horaires" data-value="horaires">
		   </div>
		   <div>
			 <label>Surface</label>
			<input data-valued="true" placeholder="Surface" data-value="surface">
		   </div>
		   <div>
			 <label>Acces net mail fb site</label>
			<input data-valued="true" placeholder="Acces net mail fb site" data-value="acces_net_mail_fb_site">
		   </div>
		   <div>
			 <label>Tel qui marche</label>
			<input data-valued="true" placeholder="Tel qui marche" data-value="tel_qui_marche">
		   </div>
		   <div>
			 <label>Produits plus</label>
			<input data-valued="true" placeholder="Produits plus" data-value="produits_plus">
		   </div>
		   <div>
			 <label>Ex prix</label>
			<input data-valued="true" placeholder="Ex prix" data-value="ex_prix">
		   </div>
		   <div>
			 <label>Usp</label>
			<input data-valued="true" placeholder="Usp" data-value="usp">
		   </div>
		   <div>
			 <label>Annee d'ouverture</label>
			<input data-valued="true" placeholder="Annee d'ouverture" data-value="annee_ouverture">
		   </div>
		   <div>
			 <label>Donnees specifiques</label>
			<input data-valued="true" placeholder="Donnees specifiques" data-value="donnees_specifiques">
		   </div>
		   	
			
			
		   
		   
		   
		   
		   
		</div>
		<div class="inputs">
		   <div class="button_b add_field">Add field</div>
		   <div class="button_b add_image">Add image</div>
		</div><div class="inputs">
		   <div class="button_b b_little action_edit">Edit</div><div class="button_b b_little action_cancel">Cancel</div>
		</div>
	</div>
	<div class="show_map_point" data-script="show_map_point">
		<div class="inputs content_info">
		   <div>
			 <img alt=" " class="img_presentation_info" data-attribute="pgimg" data-attribute_name="src"/>
		   </div>
		   <div>
			<span class="data_var_info" data-var="nom_officiel"></span>
		   </div>
		   <div>
			 <span class="data_var_info" data-var="localisation_gps"></span>
		   </div>
		   <div>
			 <label>Categorie 
			 <img alt=" " class="img_presentation_info" data-attribute="categorie_icon" data-attribute_name="src"/>
			 </label>
			 <span class="data_var_info" data-var="categorie"></span>
		   </div>
		   <div>
			 <label>Localisation pratique</label>
			 <span class="data_var_info" data-var="localisation_pratique"></span>
		   </div>
		   <div>
			 <label>Nom Connu</label>
			 <span class="data_var_info" data-var="nom_connu"></span>
		   </div>
		   <div>
			 <label>Est un point de repère</label>
			 <span class="data_var_info" data-var="repere"></span>
		   </div>
		   <div>
			 <label>Sous Categorie</label>
			 <span class="data_var_info" data-var="sous_categorie"></span>
		   </div>
		   <div>
			 <label>Quartier</label>
			 <span class="data_var_info" data-var="quartier"></span>
		   </div>
		   <div>
			 <label>Adresse</label>
			 <span class="data_var_info" data-var="adresse"></span>
		   </div>
		   <div>
			 <label>Acces</label>
			 <span class="data_var_info" data-var="acces"></span>
		   </div>
		   <div>
			 <label>Possibilite de parking</label>
			 <span class="data_var_info" data-var="possibilite_de_parking"></span>
		   </div>
		   <div>
			 <label>Endroit connus tres proche</label>
			 <span class="data_var_info" data-var="endroit_connus_tres_proche"></span>
		   </div>
		   <div>
			 <label>Jours ouverture</label>
			 <span class="data_var_info" data-var="jours_ouverture"></span>
		   </div>
		   <div>
			 <label>Horaires</label>
			 <span class="data_var_info" data-var="horaires"></span>
		   </div>
		   <div>
			 <label>Surface</label>
			 <span class="data_var_info" data-var="surface"></span>
		   </div>
		   <div>
			 <label>Acces net mail fb site</label>
			 <span class="data_var_info" data-var="acces_net_mail_fb_site"></span>
		   </div>
		   <div>
			 <label>Tel qui marche</label>
			 <span class="data_var_info" data-var="tel_qui_marche"></span>
		   </div>
		   <div>
			 <label>Produits plus</label>
			 <span class="data_var_info" data-var="produits_plus"></span>
		   </div>
		   <div>
			 <label>Ex prix</label>
			 <span class="data_var_info" data-var="ex_prix"></span>
		   </div>
		   <div>
			 <label>Usp</label>
			 <span class="data_var_info" data-var="usp"></span>
		   </div>
		   <div>
			 <label>Annee d'ouverture</label>
			 <span class="data_var_info" data-var="annee_ouverture"></span>
		   </div>
		   <div>
			 <label>Donnees specifiques</label>
			 <span class="data_var_info" data-var="donnees_specifiques"></span>
		   </div>
		   	
			
			
		   
		   
		   
		   
		   
		</div>
		<div class="inputs">
		   <div class="button_b b_little action_edit">Edit</div>
		</div>
	</div>
	<div class="show_map_point_coord" data-script="show_map_point_coord">
		<div class="inputs content_info">
		   <div>
			 <img alt=" " class="img_presentation_info" data-attribute="pgimg" data-attribute_name="src"/>
		   </div>
		   <div>
			<span class="data_var_info" data-var="nom_officiel"></span>
		   </div>
		   <div>
			 <span class="data_var_info" data-var="localisation_gps"></span>
		   </div>
		   <div>
			 <label>Categorie 
			 <img alt=" " class="img_presentation_info" data-attribute="categorie_icon" data-attribute_name="src"/>
			 </label>
			 <span class="data_var_info" data-var="categorie"></span>
		   </div>
		   <div>
			 <label>Localisation pratique</label>
			 <span class="data_var_info" data-var="localisation_pratique"></span>
		   </div>
		   <div>
			 <label>Nom Connu</label>
			 <span class="data_var_info" data-var="nom_connu"></span>
		   </div>
		   <div>
			 <label>Est un point de repère</label>
			 <span class="data_var_info" data-var="repere"></span>
		   </div>
		   <div>
			 <label>Sous Categorie</label>
			 <span class="data_var_info" data-var="sous_categorie"></span>
		   </div>
		   <div>
			 <label>Quartier</label>
			 <span class="data_var_info" data-var="quartier"></span>
		   </div>
		   <div>
			 <label>Adresse</label>
			 <span class="data_var_info" data-var="adresse"></span>
		   </div>
		   <div>
			 <label>Acces</label>
			 <span class="data_var_info" data-var="acces"></span>
		   </div>
		   <div>
			 <label>Possibilite de parking</label>
			 <span class="data_var_info" data-var="possibilite_de_parking"></span>
		   </div>
		   <div>
			 <label>Endroit connus tres proche</label>
			 <span class="data_var_info" data-var="endroit_connus_tres_proche"></span>
		   </div>
		   <div>
			 <label>Jours ouverture</label>
			 <span class="data_var_info" data-var="jours_ouverture"></span>
		   </div>
		   <div>
			 <label>Horaires</label>
			 <span class="data_var_info" data-var="horaires"></span>
		   </div>
		   <div>
			 <label>Surface</label>
			 <span class="data_var_info" data-var="surface"></span>
		   </div>
		   <div>
			 <label>Acces net mail fb site</label>
			 <span class="data_var_info" data-var="acces_net_mail_fb_site"></span>
		   </div>
		   <div>
			 <label>Tel qui marche</label>
			 <span class="data_var_info" data-var="tel_qui_marche"></span>
		   </div>
		   <div>
			 <label>Produits plus</label>
			 <span class="data_var_info" data-var="produits_plus"></span>
		   </div>
		   <div>
			 <label>Ex prix</label>
			 <span class="data_var_info" data-var="ex_prix"></span>
		   </div>
		   <div>
			 <label>Usp</label>
			 <span class="data_var_info" data-var="usp"></span>
		   </div>
		   <div>
			 <label>Annee d'ouverture</label>
			 <span class="data_var_info" data-var="annee_ouverture"></span>
		   </div>
		   <div>
			 <label>Donnees specifiques</label>
			 <span class="data_var_info" data-var="donnees_specifiques"></span>
		   </div>
		   	
			
			
		   
		   
		   
		   
		   
		</div>
		<div class="inputs">
		   <div class="button_b b_little action_edit">Edit</div>
		</div>
	</div>
	<div class="field_template">
	   <div>
		 <label data-var="label"></label>
			<input/>
	   </div>
	</div>
	<div class="field_template_new">
	   <div>
		 <input data-template_name="true" data-bulle="Nom du champ" class="input_label" data-value="label">
			<input data-template="input" data-bulle="Valeur du champ" data-value="value"/>
	   </div>
	</div>
	<div class="span_template_new">
	   <div>
		 <label data-var="label"></label>
		 <span class="data_var_info" data-var="value"></span>
	   </div>
	</div>
	<div class="field_template_new_image">
	   <div>
		 <input data-template_name="true" data-bulle="Nom du champ" class="input_label" data-value="label">
			<input type="file" data-template="file" data-bulle="Valeur du champ"/>
	   </div>
	</div>
	<div class="drawn_surface_point">
	   <div>
		 <label data-var="label"></label>
			<input data-selector="localisation_gps" data-bulle="Latitude,Longitude"/>
			<span class="remove_line">&times;</span>
	   </div>
	</div>
	<div class="surface_point_drawer">
	
	   <div class="inputs coords_value">
	   </div>
		<div class="inputs">
		   <div class="button_b b_little action_edit">Valider</div>
		</div>
	</div>
</div>

</body>

<script>
(function(){
	
	window.menu_mobile=document.querySelector(".menu_mobile");
	window.left_block=document.querySelector(".left_block");
	window.right_block=document.querySelector(".right_block");
	window.menu_presenters=document.querySelectorAll(".menu_presenter");
	window.search_bar=document.querySelector(".search_bar");
	window.search_bar_input=document.querySelector(".search_bar_input");
	window.right_option_close=document.querySelector(".right_option_close");
	window.left_block_up_bar=document.querySelector(".left_block_up_bar");
	window.left_block_down_bar=document.querySelector(".left_block_down_bar");
	window.left_block_list=document.querySelector(".left_block_list");
	window.conditionnal_lines=document.querySelectorAll(".conditionnal_line");
	window.conditionnal_liness=document.querySelectorAll(".conditionnal_lines");
	window.windowMoves=[];
	window.windowClicks=[];
	window.swl=false;
	window.swr=false;
	indexr=0;
			
	window.get_callable=get_callable
	window.template=template;
	window.set_information=set_information;
	window.appendTemplate=appendTemplate;
	window.open_right_block=open_right_block;
	window.startDrawSurface=function(){};
	window.drawCoords=function(){};
	window.cleanFps=function(){};
	window.map_main=function(){};
	window.controller={};
	window.icons={};
	window.active_map_picker=function(){}
	window.removeCoordPath=function(){}
	window.cleanMap=function(){}
	window.desactive_map_picker=function(){}
	window.drawInformation=function(){}
	window.removeMarker=function(){}
	window.removeSingleMarker=function(){}
	window.main_gps=function(){}
	window.hear_locals=function(){}
	window.getSingleMarker=function(){}
	window.readyIcon=false;
	window.wait=function(c,f){
		if(c()){
			f();
		}
		else{
			setTimeout(function(){
				window.wait(c,f);
			},100);
		}
	}
	window.iconOf=function(type){
		var icon=icons[type];
		if(!icon){
			icon="default.png"
		}
		return BASE_URL+"/assets/map/assets/icons/"+icon;
	}
	window.controller.getInitialData=function(then){
		requestFor("app/get_initial_data",then)
	};
	window.map_main=function(){
		window.opt_wait=false;
		window.using_hover=true;
		window.hoveredMarker=true;
		window.using_hover_main=true;
		window.controller.getInitialData(showDatas);
	}
	window.showCategory=showCategory;
	window.looseMapHover=function(){
		window.using_hover=false;
		using_hover_main=false;
	}
	window.useMapHover=function(){
		window.using_hover=true;
		using_hover_main=true;
	}
	window.categories=[];
	window.readyMenu=false;
	window.readyEC=false;
	window.readycategorie_select=false;
	window.categorie_select_id=false;
	function preloadCategories(then){
		window.readyIcon=false;
		getIcons();
		window.readyMenu=false;
		window.readyEC=false;
		window.readycategorie_select=false;
		window.categorie_select_id=false;
		loadContent("categories_menu","readyMenu");
		loadContent("categories_element_create","readyEC");
		loadContent("categorie_select","readycategorie_select");
		loadContent("categorie_select_id","categorie_select_id");
		wait(preloadedCategories,hear_locals);
		wait(preloadedCategories,get_callable(then));
	}
	preloadCategories(main_ready);
	function preloadedCategories(){
		return readyIcon && readyMenu && readyEC && readycategorie_select; 
	}
	
	
	
	wait(function(){
		return readyIcon && readyMenu;
	},function(){
		for_all_of(".menu_categ",execute,2);
		function execute(menu){
			menu.addEventListener("click",function(){
				var name=menu.dataset["categorie_name"];
				cleanFps();
				removeSingleMarker();
				removePath(function(){
					removeCoordPath();
				});
				showCategory(name,menu);
			});
		}
	});
	function loadContent(gl,v){
		simpleRequestFor("/app/"+gl,function(data){
			var e=document.querySelectorAll("."+gl)
			for(var i=0;i< e.length;i++ ){
				e.item(i).innerHTML=data;
			}
			window[v]=true;
		});
	}
	function showCategory(name,menu){
		if(!name){
			cleanCategories();
			cleanMap(drawCategories);
		}
		if(categories.indexOf(name)==-1){
			if(menu){
				menu.classList.add("active");
			}
			categories.push(name);
		}
		else{
			delete categories[categories.indexOf(name)]
			menu.classList.remove("active");
		}
		cleanCategories();
		cleanMap(drawCategories);
	}
	function cleanCategories(){
		var c=[];
		for(var i in categories){
			if(categories[i]){
				c.push(categories[i]);
			}
		}
		categories=c;
	}
	function drawCategories(){
		var formData=new FormData();
		formData.append("categories",JSON.stringify(categories));
		requestFor("app/get_all_of_categorie",showDatas,formData);
	}
	function showDatas(data){
		window.addEventListener("click",function(){
			if(using_hover_main){
				using_hover=true;
			}
		});
		for(var i in data){
			drawing(data[i]);
		}
		function drawing(d){
			if(d.coords && d.coords!="0"){
				var xs=JSON.parse(d.coords);
				drawCoords(xs);
			}
			var marker=drawInformation(d);
			marker.addListener("mouseout",function(){
				var icon=marker.getIcon();
				icon.scaledSize=new google.maps.Size(20, 20), // scaled size
				marker.setIcon(icon);
				var label=marker.getLabel();
				label.fontSize="12px";
				label.color="#888";
				
				marker.setLabel(label);
			})
			marker.addListener("mouseover",function(){
				if(!using_hover){
					return false;
				}
				if(hoveredMarker==d){
					return false;
				}
				var label=marker.getLabel();
				label.fontSize="15px";
				label.color="#555";
				var icon=marker.getIcon();
				icon.scaledSize=new google.maps.Size(21, 21), // scaled size
				
				marker.setLabel(label);
				marker.setIcon(icon);
				if(opt_wait){
					wait(function(){
						return !opt_wait;
					},_action)
				}
				else{
					opt_wait=true;
					action();
				}
				function action(){
					hoveredMarker=d;
					open_right_block("informations",true,true);
					setTimeout(function(){
						_action();
					},700);
				}
				function _action(){
					drawInformationPanel(d,marker);
					console.log(d.coords);
					if(d.coords && d.coords!="0"){
						window.coordst=JSON.parse(d.coords);
					}
					else{
						window.coordst=[];
					}
					open_right_block("informations",true);
					opt_wait=false;
				}
			});
			marker.addListener("click",function(){
				setTimeout(function(){
					using_hover=false;
				}
				,100)
				if(hoveredMarker==d){
					return false;
				}
				var label=marker.getLabel();
				label.fontSize="15px";
				label.color="#555";
				var icon=marker.getIcon();
				icon.scaledSize=new google.maps.Size(21, 21), // scaled size
				
				marker.setLabel(label);
				marker.setIcon(icon);
				if(opt_wait){
					wait(function(){
						return !opt_wait;
					},_action)
				}
				else{
					opt_wait=true;
					action();
				}
				function action(){
					open_right_block("informations",true,true);
					setTimeout(function(){
						_action();
					},700);
				}
				function _action(){
					drawInformationPanel(d,marker);
					open_right_block("informations",true);
					opt_wait=false;
				}
			});
		}
	}
	function requestFor(url,then,formData){
		if(!formData){
			formData=new FormData();
		}
		$.ajax({
			url: BASE_URL+'/'+url,
			type: 'POST',
			data:  formData,
			mimeType:"multipart/form-data",
			contentType: false,
			cache: false,
			processData:false,
			success: function(data, textStatus, jqXHR)
			{
				get_callable(then)(JSON.parse(data));
			},
			error: function(jqXHR, textStatus, errorThrown) 
			{
				console.log(jqXHR);
			}          
		});
	}
	function simpleRequestFor(url,then,formData){
		if(!formData){
			formData=new FormData();
		}
		$.ajax({
			url: BASE_URL+'/'+url,
			type: 'POST',
			data:  formData,
			mimeType:"multipart/form-data",
			contentType: false,
			cache: false,
			processData:false,
			success: function(data, textStatus, jqXHR)
			{
				get_callable(then)(data);
			},
			error: function(jqXHR, textStatus, errorThrown) 
			{
				console.log(jqXHR);
			}          
		});
	}
	function getIcons(){
		$.get(BASE_URL+"/app/categoriesicons",function(r){
			var datas=JSON.parse(r);
			for(var i in datas){
				window.icons[datas[i].categorie_nom]=datas[i].icon_nom;
				window.readyIcon=true;
			}
		});
	}
	
	//window.addEventListener("load",function(){
		window.tmpData=null;
		window.actions={
			"add_surface":{
				"create_map":function(e,param){
					startDrawSurface(param);
				},
				"create_map_coord":function(e,param,remember){
					var xp=param.split(",");
					open_right_block("informations",true);
					window.looseMapHover();
					var info=null;
					if(!remember){
						info=set_information(template(".create_map_point_coord",{
							"categorie":xp[0],
							"categorie_icon":'<img src="'+iconOf(xp[0])+'"/>',
							"localisation_gps":window.smp.latitude+","+window.smp.longitude,
						}));
						var ctgi=info.querySelector("*[data-value=\"categorie\"]");
						setTimeout(function(){
							ctgi.dataset["option_value"]=xp[0];
						},500);
					}
					else{
						var dkdata={};
						for(var i in window.tmpData.valued){
							dkdata[i]=window.tmpData.valued[i];
						}
						dkdata["categorie_icon"]='<img src="'+iconOf(xp[0])+'"/>';
						var gxp=dkdata.localisation_gps.split(",");
						if(!gxp.length || gxp.indexOf("null")==-1){
							dkdata.localisation_gps=window.smp.latitude+","+window.smp.longitude;
						}
						dkdata.localisation_gps=window.smp.latitude+","+window.smp.longitude;
						info=set_information(template(".create_map_point_coord",dkdata));
						
						var ctgi=info.querySelector("*[data-value=\"categorie\"]");
						setTimeout(function(){
							ctgi.dataset["option_value"]=xp[0];
						},500);
						for(var i in window.tmpData.added){
							addMore(window.tmpData.added[i],i,info);
						}
					}
					var ctgi=info.querySelector("*[data-value=\"categorie\"]");
					
					info.dataset["categorie"]=param;
					var action_edit=info.querySelector(".action_edit");
					var action_cancel=info.querySelector(".action_cancel");
					var localisation_gps=info.querySelector("*[data-value=\"localisation_gps\"]");
					main_gps(localisation_gps);
					active_map_picker(get_callable(function(){
						localisation_gps.value=window.smp.latitude+","+window.smp.longitude;
						// localisation_gps.focus();
					}));
					action_cancel.addEventListener("click",function(){
						
						cleanFps();
						removeSingleMarker();
						removePath(function(){
							removeCoordPath();
						});
						
						window.removeSingleMarker();
						window.desactive_map_picker();
						open_right_block("add_element");
						window.useMapHover();
					});
					action_edit.addEventListener("click",function(){
						window.useMapHover();
						window.removeSingleMarker();
						window.desactive_map_picker();
						var inputs=info.querySelectorAll("*[data-valued]");
						var inputs_add=info.querySelectorAll("*[data-template]");
						var inputs_name=info.querySelectorAll("*[data-template_name]");
						var formData=new FormData();
						for(var i=0;i<inputs_add.length;i++){
							formData.append("more_"+inputs_name[i].value.replace(" ","_","g"),inputs_add[i].value);
						}
						for(var i=0;i<inputs.length;i++){
							if(inputs[i].getAttribute("type")=="file" && inputs[i].files[0]){
								formData.append(inputs[i].dataset["value"],inputs[i].files[0]);
							}
							else{
								if(inputs[i].nodeName.toLowerCase()=="select"){
									formData.append(inputs[i].dataset["value"],inputs[i].dataset["option_value"]);
								}
								else{
									formData.append(inputs[i].dataset["value"],inputs[i].value);
								}
								
							}
						}
						formData.append("coords",JSON.stringify(coordst));
						$.ajax({
							url: BASE_URL+'/app/i_insertvalidreperes',
							type: 'POST',
							data:  formData,
							mimeType:"multipart/form-data",
							contentType: false,
							cache: false,
							processData:false,
							success: function(data, textStatus, jqXHR)
							{
								preloadCategories(function(){
									showCategory();
									drawInMap(data);
								});
							},
							error: function(jqXHR, textStatus, errorThrown) 
							{
								console.log(jqXHR);
							}          
						});
					});
				},
				"edit_map_point_coord":function(e,param,remember){
					var xp=param.split(",");
					open_right_block("informations",true);
					window.looseMapHover();
					var info=null;
					if(!remember){
						info=set_information(template(".edit_map_point_coord",{
							"categorie":xp[0],
							"categorie_icon":'<img src="'+iconOf(xp[0])+'"/>',
							"localisation_gps":window.smp.latitude+","+window.smp.longitude,
						}));
						var ctgi=info.querySelector("*[data-value=\"categorie\"]");
						setTimeout(function(){
							ctgi.dataset["option_value"]=xp[0];
						},500);
					}
					else{
						var dkdata={};
						for(var i in window.tmpData.valued){
							dkdata[i]=window.tmpData.valued[i];
						}
						dkdata["categorie_icon"]='<img src="'+iconOf(xp[0])+'"/>';
						
						var gxp=dkdata.localisation_gps.split(",");
						if(!gxp.length || gxp.indexOf("null")==-1){
							dkdata.localisation_gps=window.smp.latitude+","+window.smp.longitude;
						}
						// dkdata.localisation_gps=window.smp.latitude+","+window.smp.longitude;
						info=set_information(template(".edit_map_point_coord",dkdata));
						
						var ctgi=info.querySelector("*[data-value=\"categorie\"]");
						setTimeout(function(){
							ctgi.dataset["option_value"]=xp[0];
						},500);
						for(var i in window.tmpData.added){
							addMore(window.tmpData.added[i],i,info);
						}
					}
					var ctgi=info.querySelector("*[data-value=\"categorie\"]");
					
					info.dataset["categorie"]=param;
					var action_edit=info.querySelector(".action_edit");
					var action_cancel=info.querySelector(".action_cancel");
					var localisation_gps=info.querySelector("*[data-value=\"localisation_gps\"]");
					main_gps(localisation_gps);
					active_map_picker(get_callable(function(){
						localisation_gps.value=window.smp.latitude+","+window.smp.longitude;
						// localisation_gps.focus();
					}));
					action_cancel.addEventListener("click",function(){
						cleanFps();
						removeSingleMarker();
						removePath(function(){
							removeCoordPath();
						});
						
						window.removeSingleMarker();
						window.desactive_map_picker();
						open_right_block("add_element");
						window.useMapHover();
					});
					action_edit.addEventListener("click",function(){
						window.useMapHover();
						window.removeSingleMarker();
						window.desactive_map_picker();
						var inputs=info.querySelectorAll("*[data-valued]");
						var inputs_add=info.querySelectorAll("*[data-template]");
						var inputs_name=info.querySelectorAll("*[data-template_name]");
						var formData=new FormData();
						for(var i=0;i<inputs_add.length;i++){
							formData.append("more_"+inputs_name[i].value.replace(" ","_","g"),inputs_add[i].value);
						}
						for(var i=0;i<inputs.length;i++){
							if(inputs[i].getAttribute("type")=="file" && inputs[i].files[0]){
								formData.append(inputs[i].dataset["value"],inputs[i].files[0]);
							}
							else{
								if(inputs[i].nodeName.toLowerCase()=="select"){
									formData.append(inputs[i].dataset["value"],inputs[i].dataset["option_value"]);
								}
								else{
									formData.append(inputs[i].dataset["value"],inputs[i].value);
								}
								
							}
						}
						formData.append("coords",JSON.stringify(coordst));
						$.ajax({
							url: BASE_URL+'/app/i_editvalidreperes',
							type: 'POST',
							data:  formData,
							mimeType:"multipart/form-data",
							contentType: false,
							cache: false,
							processData:false,
							success: function(data, textStatus, jqXHR)
							{
								preloadCategories(function(){
									showCategory();
									drawInMap(data,true);
								});
							},
							error: function(jqXHR, textStatus, errorThrown) 
							{
								console.log(jqXHR);
							}          
						});
					});
				}
			},
			"add_point":{
				"create_map":function(e,param,remember){
					window.coordst=[];
					var xp=param.split(",");
					open_right_block("informations",true);
					window.looseMapHover();
					var info=null;
					if(!remember){
						info=set_information(template(".create_map_point_coord",{
							"categorie":xp[0],
							"categorie_icon":'<img src="'+iconOf(xp[0])+'"/>',
							"localisation_gps":window.smp.latitude+","+window.smp.longitude,
						}));
						var ctgi=info.querySelector("*[data-value=\"categorie\"]");
						setTimeout(function(){
							ctgi.dataset["option_value"]=xp[0];
						},500);
					}
					else{
						var dkdata={};
						for(var i in window.tmpData.valued){
							dkdata[i]=window.tmpData.valued[i];
						}
						dkdata["categorie_icon"]='<img src="'+iconOf(xp[0])+'"/>';
						var gxp=dkdata.localisation_gps.split(",");
						if(!gxp.length || gxp.indexOf("null")==-1){
							dkdata.localisation_gps=window.smp.latitude+","+window.smp.longitude;
						}
						dkdata.localisation_gps=window.smp.latitude+","+window.smp.longitude;
						info=set_information(template(".create_map_point_coord",dkdata));
						
						var ctgi=info.querySelector("*[data-value=\"categorie\"]");
						setTimeout(function(){
							ctgi.dataset["option_value"]=xp[0];
						},500);
						for(var i in window.tmpData.added){
							addMore(window.tmpData.added[i],i,info);
						}
					}
					var ctgi=info.querySelector("*[data-value=\"categorie\"]");
					
					info.dataset["categorie"]=param;
					var action_edit=info.querySelector(".action_edit");
					var action_cancel=info.querySelector(".action_cancel");
					var localisation_gps=info.querySelector("*[data-value=\"localisation_gps\"]");
					main_gps(localisation_gps);
					active_map_picker(get_callable(function(){
						localisation_gps.value=window.smp.latitude+","+window.smp.longitude;
						// localisation_gps.focus();
					}));
					action_cancel.addEventListener("click",function(){
						
						cleanFps();
						removeSingleMarker();
						removePath(function(){
							removeCoordPath();
						});
						
						window.removeSingleMarker();
						window.desactive_map_picker();
						open_right_block("add_element");
						window.useMapHover();
					});
					action_edit.addEventListener("click",function(){
						window.useMapHover();
						window.removeSingleMarker();
						window.desactive_map_picker();
						var inputs=info.querySelectorAll("*[data-valued]");
						var inputs_add=info.querySelectorAll("*[data-template]");
						var inputs_name=info.querySelectorAll("*[data-template_name]");
						var formData=new FormData();
						for(var i=0;i<inputs_add.length;i++){
							formData.append("more_"+inputs_name[i].value.replace(" ","_","g"),inputs_add[i].value);
						}
						for(var i=0;i<inputs.length;i++){
							if(inputs[i].getAttribute("type")=="file" && inputs[i].files[0]){
								formData.append(inputs[i].dataset["value"],inputs[i].files[0]);
							}
							else{
								if(inputs[i].nodeName.toLowerCase()=="select"){
									formData.append(inputs[i].dataset["value"],inputs[i].dataset["option_value"]);
								}
								else{
									formData.append(inputs[i].dataset["value"],inputs[i].value);
								}
								
							}
						}
						formData.append("coords",JSON.stringify(coordst));
						$.ajax({
							url: BASE_URL+'/app/i_insertvalidreperes',
							type: 'POST',
							data:  formData,
							mimeType:"multipart/form-data",
							contentType: false,
							cache: false,
							processData:false,
							success: function(data, textStatus, jqXHR)
							{
								preloadCategories(function(){
									showCategory();
									drawInMap(data);
								});
							},
							error: function(jqXHR, textStatus, errorThrown) 
							{
								console.log(jqXHR);
							}          
						});
					});
				},
				/*
				"create_map":function(e,param){
					var xp=param.split(",");
					open_right_block("informations",true);
					window.looseMapHover();
					var info=set_information(template(".create_map_point",{
						"categorie":xp[0],
						"categorie_icon":'<img src="'+iconOf(xp[0])+'"/>',
					}));
					var action_edit=info.querySelector(".action_edit");
					var action_cancel=info.querySelector(".action_cancel");
					var localisation_gps=info.querySelector("*[data-value=\"localisation_gps\"]");
					main_gps(localisation_gps);
					active_map_picker(get_callable(function(){
						localisation_gps.value=window.smp.latitude+","+window.smp.longitude;
						// localisation_gps.focus();
					}));
					action_cancel.addEventListener("click",function(){
						window.removeSingleMarker();
						window.desactive_map_picker();
						open_right_block("add_element");
						window.useMapHover();
					});
					action_edit.addEventListener("click",function(){
						window.useMapHover();
						window.removeSingleMarker();
						window.desactive_map_picker();
						var inputs=info.querySelectorAll("*[data-valued]");
						var inputs_add=info.querySelectorAll("*[data-template]");
						var inputs_name=info.querySelectorAll("*[data-template_name]");
						var formData=new FormData();
						for(var i=0;i<inputs_add.length;i++){
							formData.append("more_"+inputs_name[i].value.replace(" ","_","g"),inputs_add[i].value);
						}
						for(var i=0;i<inputs.length;i++){
							if(inputs[i].getAttribute("type")=="file" && inputs[i].files[0]){
								formData.append(inputs[i].dataset["value"],inputs[i].files[0]);
							}
							else{
								if(inputs[i].nodeName.toLowerCase()=="select"){
									formData.append(inputs[i].dataset["value"],inputs[i].dataset["option_value"]);
								}
								else{
									formData.append(inputs[i].dataset["value"],inputs[i].value);
								}
								
							}
						}
						$.ajax({
							url: BASE_URL+'/app/i_insertvalidreperes',
							type: 'POST',
							data:  formData,
							mimeType:"multipart/form-data",
							contentType: false,
							cache: false,
							processData:false,
							success: function(data, textStatus, jqXHR)
							{
								preloadCategories(function(){
									showCategory();
									drawInMap(data);
								});
							},
							error: function(jqXHR, textStatus, errorThrown) 
							{
								console.log(jqXHR);
							}          
						});
					});
				},
				*/
				
			}
		}
		
		window.getTmpDatas=function(info){
			var inputs=info.querySelectorAll("*[data-valued]");
			var inputs_add=info.querySelectorAll("*[data-template]");
			var inputs_name=info.querySelectorAll("*[data-template_name]");
			var fd={
				"valued":{},
				"added":{},
			};
			for(var i=0;i<inputs_add.length;i++){
				fd.added[inputs_name[i].value]=inputs_add[i].value;
			}
			for(var i=0;i<inputs.length;i++){
				if(inputs[i].getAttribute("type")=="file" && inputs[i].files[0]){
					fd.valued[inputs[i].dataset["value"]]=inputs[i].files[0];
				}
				else{
					if(inputs[i].nodeName.toLowerCase()=="select"){
						fd.valued[inputs[i].dataset["value"]]=inputs[i].dataset["option_value"];
					}
					else{
						fd.valued[inputs[i].dataset["value"]]=inputs[i].value;
					}
					
				}
			}
			return fd;
		}
		window.addEventListener("mousemove",windowMove);
		window.addEventListener("click",windowClick);
		
		
		var scripts={
			add_icon:function(e,option){
				var value=option.textContent;
				var img=document.createElement("img");
				var txt=document.createTextNode(" ");
				img.src=iconOf(value);
				e.insertBefore(txt,e.firstChild);
				e.insertBefore(img,e.firstChild);
			},
			create_map_point_coord:function(e){
				var edit_coords=e.querySelector(".edit_coords");
				var add_field=e.querySelector(".add_field");
				var add_image=e.querySelector(".add_image");
				var content_info=e.querySelector(".content_info");
				add_field.addEventListener("click",addField);
				add_image.addEventListener("click",addImage);
				edit_coords.addEventListener("click",editCoords);
				function editCoords(){
					window.tmpData=window.getTmpDatas(e);
					// startDrawSurface(e.dataset["categorie"],true);
					console.log(window.tmpData.valued.categorie);
					startDrawSurface(window.tmpData.valued.categorie,true);
				}
				function addField(){
					var fd=template(".field_template_new",{
						label:"New field"
					});
					appendTemplate(fd,content_info);
				}
				function addImage(){
					var fd=template(".field_template_new_image",{
						label:"New field"
					});
					appendTemplate(fd,content_info);
				}
			},
			edit_map_point_coord:function(e){
				var edit_coords=e.querySelector(".edit_coords");
				var add_field=e.querySelector(".add_field");
				var add_image=e.querySelector(".add_image");
				var content_info=e.querySelector(".content_info");
				add_field.addEventListener("click",addField);
				add_image.addEventListener("click",addImage);
				edit_coords.addEventListener("click",editCoords);
				function editCoords(){
					window.tmpData=window.getTmpDatas(e);
					console.log(window.tmpData.valued.categorie);
					// startDrawSurface(e.dataset["categorie"],true);
					console.log(window.tmpData.valued.categorie);
					startDrawSurface(window.tmpData.valued.categorie,true,true);
				}
				function addField(){
					var fd=template(".field_template_new",{
						label:"New field"
					});
					appendTemplate(fd,content_info);
				}
				function addImage(){
					var fd=template(".field_template_new_image",{
						label:"New field"
					});
					appendTemplate(fd,content_info);
				}
			},
			show_map_point_coord:function(e){
			},
			create_map_point:function(e){
				var add_field=e.querySelector(".add_field");
				var add_image=e.querySelector(".add_image");
				var content_info=e.querySelector(".content_info");
				add_field.addEventListener("click",addField);
				add_image.addEventListener("click",addImage);
				function addField(){
					var fd=template(".field_template_new",{
						label:"New field"
					});
					appendTemplate(fd,content_info);
				}
				function addImage(){
					var fd=template(".field_template_new_image",{
						label:"New field"
					});
					appendTemplate(fd,content_info);
				}
			},
			edit_map_point:function(e){
				var add_field=e.querySelector(".add_field");
				var add_image=e.querySelector(".add_image");
				var content_info=e.querySelector(".content_info");
				add_field.addEventListener("click",addField);
				add_image.addEventListener("click",addImage);
				function addField(){
					var fd=template(".field_template_new",{
						label:"New field"
					});
					appendTemplate(fd,content_info);
				}
				function addImage(){
					var fd=template(".field_template_new_image",{
						label:"New field"
					});
					appendTemplate(fd,content_info);
				}
			}
		}
		function def_vars(){
			menu_mobile=document.querySelector(".menu_mobile");
			left_block=document.querySelector(".left_block");
			right_block=document.querySelector(".right_block");
			menu_presenters=document.querySelectorAll(".menu_presenter");
			search_bar=document.querySelector(".search_bar");
			search_bar_input=document.querySelector(".search_bar_input");
			right_option_close=document.querySelector(".right_option_close");
			left_block_up_bar=document.querySelector(".left_block_up_bar");
			left_block_down_bar=document.querySelector(".left_block_down_bar");
			left_block_list=document.querySelector(".left_block_list");
			conditionnal_lines=document.querySelectorAll(".conditionnal_line");
			conditionnal_liness=document.querySelectorAll(".conditionnal_lines");
		}
		function main_ready(){
			def_vars();
			
			windowMoves=[];
			windowClicks=[];
			swl=false;
			swr=false;
			indexr=0;
				
			mime_file_inputs();
			mime_select_inputs();
			
			hear_bulles();
			hear_menu();
			hear_menu_presenter();
			hear_scrolls();
			hear_add_points_and_surfaces();
			
			window.addEventListener("click",activation_search_bar);
			window.addEventListener("keydown",activation_search_bar_key_out);
			
			right_option_close.addEventListener("click",switch_right_block_close);
			hear_locals=function(){
				def_vars();
				hear_conditionnal_lines();
			}
			hear_locals();
		}
		
		
		function mime_select_inputs(){
			var indexZ=1000;
			for_all_of(".inputs select",execute,2);
			function execute(e){
				e.value=e.getAttribute("value");
				// if(!e.getAttribute("value")){
					// return null;
				// }
				if(e.getAttribute("value")){
					e.dataset["option_value"]=e.getAttribute("value");
				}
				var mime=getMime();
				e.parentNode.appendChild(mime);
				
				
				if(
					!e.parentNode.style.position && (
						!window.getComputedStyle(e.parentNode).position ||
						window.getComputedStyle(e.parentNode).position=="static"
					)
				){
					e.parentNode.style.position="relative";
					e.parentNode.style.zIndex=indexZ;
					indexZ--;
				}
				var width=e.getBoundingClientRect().width+21;
				mime.style.width=width+"px";
				cron(function(){
					var x=e.getBoundingClientRect().x-e.parentNode.getBoundingClientRect().x-10;
					var y=e.getBoundingClientRect().y-e.parentNode.getBoundingClientRect().y-3;
					var height=e.getBoundingClientRect().height;
					// y=y+height;
					mime.style.left=x+"px";
					mime.style.top=y+"px";
					mime.style.lineHeight=height+"px";
				});
				function getMime(){
					var mime=e.parentNode.querySelector(".select_virtual");
					var text="";
					var input=document.createElement("input");
					text+=input.outerHTML;
					var dtext="";
					
					var options=e.querySelectorAll("option");
					for(var i=0;i < options.length;i++){
						var de=document.createElement("div");
						de.textContent=options[i].textContent;
						de.dataset["option_value"]=options[i].value;
						de.dataset["option_text"]=options[i].textContent;
						call_script(options[i].dataset["script"],[de,options[i]]);
						dtext+=de.outerHTML;
					}
					var xt=document.createElement("span");
					xt.classList.add("virtual_select_span");
					xt.innerHTML=dtext;
					if(!mime){
						mime=document.createElement("div");
						mime.classList.add("select_virtual");
					}
					text+=xt.outerHTML;
					mime.innerHTML=text;
					var input=mime.querySelector("input");
					
					e.addEventListener("change",function(){
						if(e.selectedOptions.item(0)){
							input.value=e.selectedOptions.item(0).textContent;
						}
					});
					setTimeout(function(){
						if(e.selectedOptions.item(0)){
							input.value=e.selectedOptions.item(0).textContent;
						}
					},100);
					input.addEventListener("keydown",function(){
						setTimeout(function(){
							e.value=input.value;
							e.dataset["option_value"]=input.value;
							var options=mime.querySelectorAll("*[data-option_value]");
							for(var i=0;i<options.length;i++){
								if(input.value){
									if(options[i].dataset["option_text"].indexOf(input.value)!=-1){
										options[i].style.display="block";
									}
									else{
										options[i].style.display="none";
									}
								}
								else{
									options[i].style.display="block";
								}
							}
						},100);
					});
					windowClicks.push(function(ev){
						if(ev.target==mime || exist(ev.target,mime)){
							var span=mime.querySelector("span");
							if(span){
								if(
									exist(ev.target,span) &&
									ev.target.dataset["option_value"]!==undefined &&
									ev.target.dataset["option_text"]!==undefined
								){
									mime.classList.remove("display");
									input.value=ev.target.dataset["option_text"];
									e.value=ev.target.dataset["option_value"];
									e.dataset["option_value"]=ev.target.dataset["option_value"];
								}
								else{
									mime.classList.add("display");
								}
								
							}
							else{
								mime.classList.remove("display");
							}
						}
						else{
							mime.classList.remove("display");
						}
					});
					return mime;
				}
			}
		}
		function mime_file_inputs(){
			for_all_of(".inputs input[type=\"file\"]",execute_file,2);
			function execute_file(e){
				var mime=getMime();
				e.parentNode.appendChild(mime);
				
				e.addEventListener("change",function(ev){
					if(e.files[0] && e.files[0].type && e.files[0].type.toLowerCase().indexOf("image")!=-1){
						drawImg();
					}
				});
				function drawImg(){
					var url=window.URL.createObjectURL(e.files[0]);
					var img=mime.querySelector("img");
					if(!img){
						img=document.createElement("img");
						if(mime.firstChild){
							mime.insertBefore(img,mime.firstChild);
						}
						else{
							mime.appendChild(img);
						}
					}
					img.src=url;
					window.URL.revokeObjectURL(url);
				}
				
				
				if(
					!e.parentNode.style.position && (
						!window.getComputedStyle(e.parentNode).position ||
						window.getComputedStyle(e.parentNode).position=="static"
					)
				){
					e.parentNode.style.position="relative";
				}
				cron(function(){
					var x=e.getBoundingClientRect().x-e.parentNode.getBoundingClientRect().x;
					var y=e.getBoundingClientRect().y-e.parentNode.getBoundingClientRect().y;
					var width=e.getBoundingClientRect().width;
					var height=e.getBoundingClientRect().height;
					mime.style.left=x+"px";
					mime.style.top=y+"px";
					mime.style.width=width+"px";
					mime.style.height=height+"px";
					mime.style.lineHeight=height+"px";
				});
				function getMime(){
					var mime=e.parentNode.querySelector(".file_mime");
					var text="";
					if(e.dataset["text"]){
						text=e.dataset["text"];
					}
					else{
						text="Browse File";
					}
					if(!mime){
						mime=document.createElement("div");
						mime.classList.add("file_mime");
					}
					var vtext=document.createElement("span");
					vtext.innerHTML=text;
					text=vtext.outerHTML;
					mime.innerHTML=text;
					return mime;
				}
			}
		}
		
		function drawInMap(data,xp){
			removeCoordPath()
			if(xp){
				xp="_x";
			}
			else{
				xp="";
			}
			if(data && data!="null"){
				
			}
			else{
				return false;
			}
			var formData=new FormData();
			formData.append("id",data);
			$.ajax({
				url: BASE_URL+'/app/get_repere_info'+xp,
				type: 'POST',
				data:  formData,
				mimeType:"multipart/form-data",
				contentType: false,
				cache: false,
				processData:false,
				success: function(data, textStatus, jqXHR)
				{
					var d=JSON.parse(data);
					var marker=drawInformation(d);
					drawInformationPanel(d,marker);
					showDatas([d]);
				},
				error: function(jqXHR, textStatus, errorThrown) 
				{
					console.log(jqXHR);
				}          
			});
		}
		function addMoreSpan(more,i,fd){
			var content_info=fd.querySelector(".content_info");
			var fd=template(".span_template_new",{
				label:i,
				value:more,
			});
			appendTemplate(fd,content_info);
		}
		function addMore(more,i,fd){
			var content_info=fd.querySelector(".content_info");
			var fd=template(".field_template_new",{
				label:i,
				value:more,
			});
			appendTemplate(fd,content_info);
		}
		
		function drawInformationPanel(data,marker){
			var fdata={};
			var localisation_gps="";
			var latitude="";
			var longitude="";
			for(var i in data){
				if(i=="latitude"){
					latitude=data[i];
				}
				else if(i=="longitude"){
					longitude=data[i];
				}
				else{
					fdata[i]=data[i];
				}
				
			}
			fdata["pgimg"]=BASE_URL+"app/get_repere_img?id="+fdata["id"];
			localisation_gps=latitude+", "+longitude;
			fdata["localisation_gps"]=localisation_gps;
			var kdata={};
			for(var i in fdata){
				kdata[i]=fdata[i];
			}
			kdata.categorie_icon=iconOf(kdata.categorie);
			kdata.repere=(fdata.repere-0?"oui":"non");
			kdata.possibilite_de_parking=(fdata.possibilite_de_parking-0?"oui":"non");
			
			var info=null;
			var useCoord=false;
			var fuseCoord=false;
			if((data.coords && data.coords!="0" )|| true){
				if(data.coords && data.coords!="0" ){
				}
				else{
					window.coordst=[];
					fuseCoord=true;
				}
				useCoord=true;
				info=set_information(template(".show_map_point_coord",kdata));
			}
			else{
				info=set_information(template(".show_map_point",kdata));
			}
			var more=JSON.parse(data.more);
			for(var i in more){
				addMoreSpan(more[i],i,info);
			}
			
			var action_edit=info.querySelector(".action_edit");
			action_edit.addEventListener("click",function(){
				var kdata={};
				for(var i in fdata){
					kdata[i]=fdata[i];
				}
				kdata.categorie=fdata.id_categorie
				window.looseMapHover();
				var info=null
				if(useCoord || true){
					info=set_information(template(".edit_map_point_coord",kdata));
					var ctgi=info.querySelector("*[data-value=\"categorie\"]");
					ctgi.dataset["option_value"]=ctgi.value;
					setTimeout(function(){
						ctgi.dataset["option_value"]=kdata.categorie;
					},500);
					var more=JSON.parse(data.more);
					for(var i in more){
						addMore(more[i],i,info);
					}
					window.tmpData=window.getTmpDatas(info);
					cleanFps();
					regenerateFp();
					
					var localisation_gps=info.querySelector("*[data-value=\"localisation_gps\"]");
					main_gps(localisation_gps);
					console.log(marker);
					removeMarker(marker);
					active_map_picker(get_callable(function(){
						localisation_gps.value=window.smp.latitude+","+window.smp.longitude;
						// localisation_gps.focus();
					}));
					
					var action_edit=info.querySelector(".action_edit");
					var action_cancel=info.querySelector(".action_cancel");
					
					action_cancel.addEventListener("click",function(){
						
						cleanFps();
						removeSingleMarker();
						removePath(function(){
							removeCoordPath();
						});
						
						window.useMapHover();
						window.removeSingleMarker();
						window.desactive_map_picker();
						drawInMap(data.id,true);
					});
					action_edit.addEventListener("click",function(){
						window.useMapHover();
						window.removeSingleMarker();
						window.desactive_map_picker();
						var inputs=info.querySelectorAll("*[data-valued]");
						var inputs_add=info.querySelectorAll("*[data-template]");
						var inputs_name=info.querySelectorAll("*[data-template_name]");
						var formData=new FormData();
						for(var i=0;i<inputs_add.length;i++){
							formData.append("more_"+inputs_name[i].value.replace(" ","_","g"),inputs_add[i].value);
						}
						for(var i=0;i<inputs.length;i++){
							if(inputs[i].getAttribute("type")=="file" && inputs[i].files[0]){
								formData.append(inputs[i].dataset["value"],inputs[i].files[0]);
							}
							else{
								formData.append(inputs[i].dataset["value"],inputs[i].value);
							}
						}
						
						formData.append("coords",JSON.stringify(coordst));
						$.ajax({
							url: BASE_URL+'/app/i_editvalidreperes',
							type: 'POST',
							data:  formData,
							mimeType:"multipart/form-data",
							contentType: false,
							cache: false,
							processData:false,
							success: function(data, textStatus, jqXHR)
							{
								showCategory();
								drawInMap(data,true);
							},
							error: function(jqXHR, textStatus, errorThrown) 
							{
								console.log(jqXHR);
							}          
						});
					});
					return true;
				}
				else{
					info=set_information(template(".edit_map_point",kdata));
				}
				var more=JSON.parse(data.more);
				for(var i in more){
					addMore(more[i],i,info);
				}
				var localisation_gps=info.querySelector("*[data-value=\"localisation_gps\"]");
				main_gps(localisation_gps);
				removeMarker(marker);
				active_map_picker(get_callable(function(){
					localisation_gps.value=window.smp.latitude+","+window.smp.longitude;
					// localisation_gps.focus();
				}));
				
				var action_edit=info.querySelector(".action_edit");
				var action_cancel=info.querySelector(".action_cancel");
				
				action_cancel.addEventListener("click",function(){
					window.useMapHover();
					window.removeSingleMarker();
					window.desactive_map_picker();
					drawInMap(data.id,true);
				});
				action_edit.addEventListener("click",function(){
					window.useMapHover();
					window.removeSingleMarker();
					window.desactive_map_picker();
					var inputs=info.querySelectorAll("*[data-valued]");
					var inputs_add=info.querySelectorAll("*[data-template]");
					var inputs_name=info.querySelectorAll("*[data-template_name]");
					var formData=new FormData();
					for(var i=0;i<inputs_add.length;i++){
						formData.append("more_"+inputs_name[i].value.replace(" ","_","g"),inputs_add[i].value);
					}
					for(var i=0;i<inputs.length;i++){
						if(inputs[i].getAttribute("type")=="file" && inputs[i].files[0]){
							formData.append(inputs[i].dataset["value"],inputs[i].files[0]);
						}
						else{
							formData.append(inputs[i].dataset["value"],inputs[i].value);
						}
					}
					$.ajax({
						url: BASE_URL+'/app/i_editvalidreperes',
						type: 'POST',
						data:  formData,
						mimeType:"multipart/form-data",
						contentType: false,
						cache: false,
						processData:false,
						success: function(data, textStatus, jqXHR)
						{
							showCategory();
							drawInMap(data,true);
						},
						error: function(jqXHR, textStatus, errorThrown) 
						{
							console.log(jqXHR);
						}          
					});
				});
			});
		}
		
		function appendTemplate(t,p){
			var d=document.createElement("div");
			d.innerHTML=t.text;
			call_script(t.script,[d]);
			var cns=d.childNodes;
			var l=cns.length;
			for(var i=0;i<l;i++){
				p.appendChild(cns[i]);
			}
		}
		function template(smt,data){
			var templates=document.querySelector(".templates");
			var e=templates.querySelector(smt);
			if(e){
				return r_clone();
			}
			return {
				text:""
			};
			function r_clone(){
				var d=document.createElement("div");
				d.innerHTML=e.outerHTML;
				var vars=d.querySelectorAll("*[data-var]");
				var values=d.querySelectorAll("*[data-value]");
				var attributes=d.querySelectorAll("*[data-attribute][data-attribute_name]");
				for(var i=0;i<attributes.length;i++){
					var value=data[attributes[i].dataset["attribute"]];
					var value_name=attributes[i].dataset["attribute_name"];
					if(value && value_name){
						attributes[i].setAttribute(value_name,value);
					}
				}
				for(var i=0;i<vars.length;i++){
					var value=data[vars[i].dataset["var"]];
					if(value){
						vars[i].innerHTML=value;
					}
				}
				for(var i=0;i<values.length;i++){
					var value=data[values[i].dataset["value"]];
					if(value){
						values[i].setAttribute("value",value);
					}
				}
				return {
					"text":d.innerHTML,
					"script":e.dataset["script"],
				};
			}
		}
		function set_information(t){
			var index=getConditionnal_line("informations");
			if(index!==null){
				return readInfo();
			}
			function readInfo(){
				var e=conditionnal_liness.item(index);
				e.innerHTML=t.text;
				call_script(t.script,[e]);
				return e;
			}
		}
		function call_script(s,p){
			if(typeof scripts[s]=="function"){
				scripts[s].apply(this,p);
			}
		}
		
		
		
		
		
		function hear_menu(){
			menu_mobile.addEventListener("click",switch_left_block);
		}
		function hear_menu_presenter(){
			for(var i=0;i<menu_presenters.length;i++){
				menu_presenters[i].addEventListener("click",switch_right_block(i));
			}
		}
		function windowMove(){
			for(var i=0;i<windowMoves.length;i++){
				call_function(windowMoves[i],arguments);
			}
		}
		function windowClick(){
			for(var i=0;i<windowClicks.length;i++){
				call_function(windowClicks[i],arguments);
			}
		}
		function call_function(f,p){
			if(f && typeof f=="function"){
				return f.apply(this,p);
			}
			return false;
		}
		function get_callable(f){
			if(f && typeof f=="function"){
				return f;
			}
			return function(){};
		}
		function hear_bulles(){
			for_all_of("*[data-bulle]",execute,2);
			function execute(e){
				var out=true;
				var bulle=document.createElement("div");
				bulle.classList.add("bulle");
				bulle.innerHTML=e.dataset["bulle"];
				if(
					!e.style.position && (
						!window.getComputedStyle(e).position ||
						window.getComputedStyle(e).position=="static"
					)
				){
					e.style.position="relative";
				}
				document.body.appendChild(bulle);
				windowMoves.push(_show);
				
				bulle.addEventListener("click",_hide)
				function _hide(){
					bulle.classList.remove("active");
					out=true;
				}
				function _show(ev){
					if(
						exist(ev.target,e) || e==ev.target ||
						exist(ev.target,bulle) || bulle==ev.target
					){
						out=false;
						setTimeout(function(){
							if(!out){
								show();
							}
						},500);
					}
					else{
						_hide();
					}
				}
				function show(){
					bulle.classList.add("active");
					var rect=e.getBoundingClientRect();
					var x=rect.x;
					var y=rect.y-rect.height;
					if(y<=0){
						y=rect.y+rect.height+15;
						bulle.classList.add("bulle_bottom");
					}
					else{
						bulle.classList.remove("bulle_bottom");
					}
					if(x+rect.width+100>=window.screen.width){
						x=rect.x-bulle.getBoundingClientRect().width;
						bulle.classList.add("bulle_right");
					}
					else{
						bulle.classList.remove("bulle_right");
					}
					x=x+document.body.scrollLeft;
					y=y+document.body.scrollTop;
					bulle.style.left=x+"px";
					bulle.style.top=y+"px";
				}
			}
		}
		function hear_add_points_and_surfaces(){
			hear_add_points();
			hear_add_surfaces();
			function hear_add_points(){
				var a="add_point:";
				var l=a.length
				for_all_of("*[data-action^=\""+a+"\"]",execute,2);
				function execute(e){
					e.style.cursor="pointer";
					e.addEventListener("click",handling);
					function handling(){
						var action = e.dataset["action"].substring(l);
						var p=action.indexOf(":");
						var param=null;
						if(p!=-1){
							param=action.substring(p+1);
							action=action.substring(0,p);
							cleanFps();
							removeSingleMarker();
							removePath(function(){
								removeCoordPath();
							});
							if(actions && actions["add_point"] && actions["add_point"][action]){
								actions["add_point"][action](e,param);
							}
						}
					}
				}
			}
			function hear_add_surfaces(){
				var a="add_surface:";
				var l=a.length
				for_all_of("*[data-action^=\""+a+"\"]",execute,2);
				function execute(e){
					e.style.cursor="pointer";
					e.addEventListener("click",handling);
					function handling(){
						var action = e.dataset["action"].substring(l);
						var p=action.indexOf(":");
						var param=null;
						if(p!=-1){
							param=action.substring(p+1);
							action=action.substring(0,p);
							cleanFps();
							removeSingleMarker();
							removePath(function(){
								removeCoordPath();
							});
							if(actions && actions["add_surface"] && actions["add_surface"][action]){
								actions["add_surface"][action](e,param);
							}
						}
					}
				}
			}
		}
		function exist(what,inside,_default){
			if(!_default){
				_default=document.body;
			}
			if(!inside){
				inside=_default;
			}
			if(what && what.parentNode){
				if(what.parentNode==inside){
					return true;
				}
				return exist(what.parentNode,inside);
			}
			return false;
		};
		function for_all_of(smt,__do,persistance){
			var code=Date.now();
			/**
			persistance = 
				false / undefined : not looping
				1 : looping on an class attribute indicator
				2 : lopping on an object attribute indicator
			*/
			if(!persistance){
				just_loop();
			}
			else if(persistance == 1){
				loop_on_class();
			}
			else if(persistance == 2){
				loop_on_attribute();
			}
			function just_loop(){
				var smts=document.querySelectorAll(smt);
				for(var i=0;i<smts.length;i++){
					_do(smts[i]);
				}
			}
			function loop_on_class(){
				var crn=cron(execute);
				function execute(){
					var smts=document.querySelectorAll(smt+":not(.for_all_ofed)");
					for(var i=0;i<smts.length;i++){
						smts[i].classList.add("for_all_ofed");
						_do(smts[i]);
					}
				}
			}
			function loop_on_attribute(){
				var crn=cron(execute);
				function execute(){
					var smts=document.querySelectorAll(smt);
					for(var i=0;i<smts.length;i++){
						if(!smts[i].for_all_ofed){
							smts[i].for_all_ofed=[];
							smts[i].for_all_ofed.push(code);
							_do(smts[i]);
						}
						else if(smts[i].for_all_ofed.indexOf(code)==-1){
							smts[i].for_all_ofed.push(code);
							_do(smts[i]);
						}
					}
				}
			}
			function _do(smt){
				__do(smt);
			}
		}
		function cron(f,t){
			if(!t){
				t=100;
			}
			var stopped=false;
			var o={
				start:function(){
					stopped=false
					running(f);
				},
				stop:function(){
					stopped=true;
				},
				setF:function(f){
					f=df;
				},
				getF:function(){
					return f;
				}
			}
			o.start();
			function running(f){
				if(!stopped){
					f();
					setTimeout(function(){
						running(f);
					},t);
				}
			}
			return o;
		}
		function hear_conditionnal_lines(){
			for(var i=0;i<conditionnal_lines.length;i++){
				react(i)
			}
			function react(i){
				var e=conditionnal_lines[i];
				e.addEventListener("click",openNearest);
				function openNearest(){
					var nears=e.parentNode.childNodes;
					for(var j=0;j<nears.length;j++){
						if(nears[j].classList && nears[j].classList.contains("inner_conditionnals")){
							if(nears[j].classList.contains("active")){
								nears[j].classList.remove("active");
							}
							else{
								nears[j].classList.add("active");
							}
						}
					}
				}
			}
		}
		function hear_scrolls(){
			
			var d=42;
			var scrl=0;
			left_block_up_bar.addEventListener("click",remScroll);
			left_block_down_bar.addEventListener("click",addScroll);
			function remScroll(){
				if(scrl-d>=0){
					scrl=scrl-d;
				}
				else{
					scrl=0;
				}
				update();
			}
			function addScroll(){
				if(scrl+3*d<=h(document.querySelector(".categories_menu"))){
					scrl=scrl+d;
				}
				else{
					scrl=h(document.querySelector(".categories_menu"))-2*d;
				}
				update();
			}
			function h(e){
				return window.getComputedStyle(e)["height"].substring(0,window.getComputedStyle( e)["height"].length-2)-0
			}
			function t(e){
				return window.getComputedStyle(e)["top"].substring(0,window.getComputedStyle( e)["top"].length-2)-0
			}
			function update(){
				var iv=t(document.querySelector(".categories_menu"));
				var m=10;
				var k=0;
				consume()
				function consume(){
					//left_block_list.scrollTop=iv+(scrl-iv)*k/m;
					document.getElementById("ibl").innerHTML=".categories_menu{top:"+(iv+(-scrl-iv)*k/m)+";}";
					if(k==m){
						return true;
					}
					setTimeout(function(){
						k++;
						consume()
					},1);
					
					
				}
			}
		}
		function activation_search_bar_key_out(e){
			if(e.keyCode==27 || e.keyCode==9){
				desactivate_search_bar();
			}
		}
		function activation_search_bar(e){
			if(e.target==search_bar_input){
				activate_search_bar();
			}
			else{
				desactivate_search_bar();
			}
		}
		function desactivate_search_bar(){
			search_bar.classList.remove("active");
			search_bar_input.blur();
		}
		function activate_search_bar(){
			search_bar.classList.add("active");
		}
		function switch_right_block(i){
			return function(){
				return _switch_right_block(i);
			}
		}
		function open_right_block(name,force,close){
			var i=getConditionnal_line(name);
			if(i!==null){
				_switch_right_block(i,force,close);
			}
		}
		function getConditionnal_line(name){
			for(var j=0;j<conditionnal_liness.length;j++){
				if(conditionnal_liness.item(j).dataset["name"]==name){
					return j;
				}
			}
			return null;
		}
		function _switch_right_block(i,force,close){
			for(var j=0;j<conditionnal_liness.length;j++){
				conditionnal_liness.item(j).classList.remove("active");
			}
			if(conditionnal_liness.item(i)){
				conditionnal_liness.item(i).classList.add("active");
			}
			if(close){
				switch_right_block_close(i);
			}
			else if(force){
				switch_right_block_open(i);
			}
			else if(!swr){
				switch_right_block_open(i);
			}
			else{
				if(indexr==i){
					switch_right_block_close(i);
				}
				else{
					switch_right_block_open(i);
				}
			}
		}
		function switch_right_block_open(i){
			right_block.classList.add("active");
			swr=true;
			indexr=i;
			for(var j=0;j<menu_presenters.length;j++){
				menu_presenters[j].classList.remove("presented");
			}
			menu_presenters[i].classList.add("presented");
			
		}
		function switch_right_block_close(i){
			right_block.classList.remove("active");
			swr=false;
		}
		function switch_left_block(){
			if(!swl){
				left_block.classList.add("active");
				menu_mobile.classList.add("active");
				swl=true;
			}
			else{
				left_block.classList.remove("active");
				menu_mobile.classList.remove("active");
				swl=false;
			}
		}
		
	//});
})()
</script>



<script type="text/javascript">
function map_element(){





	var myStyles =[

		{

			featureType: "poi",

			elementType: "labels",

			stylers: [

				  { visibility: "off" }

			]

		},

		{

				featureType: "transit.station.bus",

				stylers: [

				  { visibility: "off" }

				]

			  }

	];







	var mapProp= {

		center:new google.maps.LatLng(-18.908431, 47.535145),

		zoom:17,

		styles: myStyles 

	};

	window.map=new google.maps.Map(document.querySelector(".map_element"),mapProp);
	window.singleMarker=null;
	window.smp={
		latitude:0,
		longitude:0,
	}
	window.drawMarker=createMarker
	window.drawInformation=drawInformation
	window.removeMarker=removeMarker
	window.removeSingleMarker=removeSingleMarker
	window.main_gps=main_gps;
	var markers=[];
	window.cleanMap=function(then){
		for(var i in markers){
			removeMarker(markers[i]);
		}
		cleanFps();
		get_callable(then)();
	}
	
	
	
	function main_gps(e){
		if(e){
			getSingleMarker();
			action();
			e.addEventListener("keydown",action);
		}
		function action(){
			setTimeout(function(){
				if(singleMarker){
					var lt=e.value.trim().split(",");
					if(lt[1]){
						setSingleMarkerPosition(lt[0],lt[1]);
					}
				}
			},100);
		
		}
	}
	function removeSingleMarker(){
		removeMarker(getSingleMarker())
		singleMarker=null;
	}
	function map_picking(e){
		var latitude = e.latLng.lat();
		var longitude = e.latLng.lng();
		setSingleMarkerPosition(latitude,longitude);
	}
	function drawInformation(data){
		if(data && data.id){
			return drawing();
		}
		function drawing(){
			var icon=window.iconOf(data.categorie);
			var marker=createMarker(data.latitude,data.longitude,data.nom_officiel,/*"app/get_repere_img?id="+data.id*/
				icon
			);
			return marker;
		}
	}
	function getSingleMarker(){
		if(!singleMarker){
			singleMarker=createMarker(0,0);
		}
		return singleMarker;
	}
	function createMarker(latitude,longitude,label,icon,size){
		if(!icon){
			icon=BASE_URL+"assets/map/assets/default_icons/default.png";
		}
		if(!label){
			label=" ";
		}
		var position=new google.maps.LatLng(latitude,longitude);
		scale="12px";
		if(label==" "){
			scale="1px;"
		}
		var w=20;
		var h=20;
		if(size){
			w=size[0];
			h=size[1];
		}
		var marker = new google.maps.Marker({
		  label:{
			"text": label,
			"color": "#888",
			"fontSize": scale,
		  },
		  map: map,
		  position: position,
		  icon:{
			url: icon,
			scaledSize: new google.maps.Size(w, h), // scaled size
			fillOpacity: 1,
			labelOrigin: new google.maps.Point(10, 30)
		  },

		});
		markers.push(marker);
		return marker;
	}
	function removeMarker(marker){
		marker.setMap(null);
	}
	function setSingleMarkerPosition(latitude,longitude){
		smp.latitude=latitude;
		smp.longitude=longitude;
		var position=new google.maps.LatLng(latitude,longitude);
		getSingleMarker().setPosition(position);
	}
	function setMarkerPosition(marker,latitude,longitude){
		var position=new google.maps.LatLng(latitude,longitude);
		marker.setPosition(position);
	}
	
	function map_picking_effect(){
		
	}
	window.active_map_picker=function(f){
		map_picking_effect=function(){
			map_picking.apply(this,arguments);
			f.apply(this,arguments);
		};
	}
	window.desactive_map_picker=function(){
		map_picking_effect=function(){};
	}

	google.maps.event.addListener(map, 'click', function(e) {
		map_picking_effect(e);
	})


	var geocoder = new google.maps.Geocoder;
	wait(function(){
		return window.readyIcon;
	},function(){
		window.map_main();
	});
	var fps=[];
	cleanFps=function(){
		for(var i in fps){
			if(fps[i]){
				fps[i].setMap(null);
			}
		}
	}
	var flightPath=null;
	function createFp(coords,stc,fill){
		if(!stc){
			stc="#AAAAAA";
		}
		if(!fill){
			fill="#DDDDDD";
		}
		var fp = new google.maps.Polygon({
			path: coords,
			strokeColor: stc,
			strokeOpacity: 0.8,
			strokeWeight: 1,
			fillOpacity: 0.4,
			fill: fill
		  });
		  fp.setMap(map);
		  fps.push(fp);
		  return fp;
	}
	function usePath(){
		var flightPath = new google.maps.Polyline({
		// var flightPath = new google.maps.Polygon({
			path: [],
			strokeColor: "#0000FF",
			strokeOpacity: 0.8,
			strokeWeight: 2,
			fillOpacity: 0.4,
			//fill: "#DDDDDD"
		  });
		  flightPath.setMap(map);
		  return flightPath;
	}
	window.removePath=function(f){
		if(!flightPath){
			return false;
		}
		flightPath.setMap(null);
		get_callable(f)();
	}
	
	var ms=[];
	window.coordst=[];
	var coords=[];
	var sps=[];
	var spsf=[];
	var us=[];
	drawCoords=function(coodinates){
		coordst=[];
		var c=[];
		for(var i in coodinates){
			updatePosition(coodinates[i].x,coodinates[i].y);
		}
		createFp(c);
		function updatePosition(latitude,longitude){
			position=new google.maps.LatLng(latitude,longitude); 
			c.push(position);
			coordst[i]={x:latitude,y:longitude };
		}
	}
	removeCoordPath=function(){
		removePath();
		for(var i in ms){
			if(ms[i]){
				removeMarker(ms[i]);
			}
		}
	}
	window.regenerateFp=function(){
		flightPath = usePath();
		var coordstp=[];
		for(var i in coordst){
			coordstp[i]=coordst[i];
		}
		for(var i in coordstp){
			if(coordst[i]){
				addLine();
				us[i](coordstp[i].x,coordstp[i].y)
			}
		}
		coordst=coordstp;
		addLine();
		cleanCoordst();
		function addLine(){
			var marker=createMarker(undefined,undefined,undefined,undefined,[10,10]);
			ms.push(marker);
			var spi=sps.length;
			sps.push(null);
			var line=template(".drawn_surface_point",{
				label:"point : "
			});
			var position=null; 
			coords.push(position);
			
			coordst.push(null);
			us.push(updatePosition);
			function updatePosition(latitude,longitude){
				setSingleMarkerPosition(latitude,longitude);
				position=new google.maps.LatLng(latitude,longitude); 
				setMarkerPosition(marker,latitude,longitude);
				coords[spi]=position;
				flightPath.setPath(ordv());
				coordst[spi]={x:latitude,y:longitude };
			}
			function ordv(){
				var o=[];
				var gotten=false;
				for(var i in coords){
					if(coords[i]){
						if(!gotten){
							gotten=coords[i];
						}
						o.push(coords[i]);
					}
				}
				if(gotten){
					o.push(gotten)
				}
				return o;
			}
			function action(latitude,longitude){
				updatePosition(latitude,longitude);
			}
		}
	}
	
	window.cleanCoordst=function(){
		var c=[];
		for(var i in coordst){
			if(coordst[i]){
				c.push(coordst[i]);
			}
		}
		coordst=c;
		return c;
	}
	startDrawSurface=function(categorie,remember,edit){
		cleanFps();
		removeSingleMarker();
		removePath(function(){
			removeCoordPath();
		});
		flightPath = usePath();
		window.looseMapHover();
		ms=[];
		us=[];
		coords=[]
		sps=[];
		spsf=[];
		
		open_right_block("informations",true);
		var info=set_information(template(".surface_point_drawer",{
			
		}));
		var coords_value=info.querySelector(".coords_value");
		var sm=getSingleMarker();
		var lgp=null;
		active_map_picker(reaction)
		
		if(remember){
			for(var i in coordst){
				if(coordst[i]){
					addLine();
					us[i](coordst[i].x,coordst[i].y,true)
				}
			}
			if(coordst.length==0){
				addLine();
			}
		}
		else{
			coordst=[]
			addLine();
		}
		
		setCurrent(0);
		var action_edit=info.querySelector(".action_edit");
		action_edit.addEventListener("click",function(){
			cleanCoordst();
			if(edit){
				actions["add_surface"]["edit_map_point_coord"](null,categorie,remember);
			}
			else{
				actions["add_surface"]["create_map_coord"](null,categorie,remember);
			}
		});
		function setCurrent(index){
			lgp=sps[index];
		}
		function reaction(){
			if(lgp){
				lgp.value=window.smp.latitude+","+window.smp.longitude;
				spsf[lgp.dataset["index"]](window.smp.latitude,window.smp.longitude);
			}
		}
		function addLine(){
			var marker=createMarker(undefined,undefined,undefined,undefined,[10,10]);
			ms.push(marker);
			var spi=sps.length;
			var line=template(".drawn_surface_point",{
				label:"point : "
			});
			var div=document.createElement("div");
			appendTemplate(line,div);
			coords_value.appendChild(div);
			var localisation_gps=div.querySelector("*[data-selector=\"localisation_gps\"]");
			var remove_line=div.querySelector(".remove_line");
			localisation_gps.dataset["index"]=spi;
			var position=null; 
			coords.push(position);
			
			
			
			
			spsf.push(action);
			coordst.push(null);
			sps.push(localisation_gps);
			localisation_gps.addEventListener("click",function(){
				setCurrent(spi)
				var x=localisation_gps.value.trim().split(",");
				if(x.length==2){
					setSingleMarkerPosition(x[0],x[1]);
				}
			});
			localisation_gps.addEventListener("keydown",function(){
				setTimeout(function(){
					var x=localisation_gps.value.trim().split(",");
					if(x.length==2){
						updatePosition(x[0],x[1]);
					}
				},100);
			});
			remove_line.addEventListener("click",function(){
				div.parentNode.removeChild(div);
				removeMarker(ms[spi]);
				delete sps[spi];
				delete spsf[spi];
				delete coords[spi];
				delete ms[spi];
				delete us[spi];
				delete coordst[spi];
				flightPath.setPath(ordv());
			});
			us.push(updatePosition);
			function updatePosition(latitude,longitude,force){
				setSingleMarkerPosition(latitude,longitude);
				position=new google.maps.LatLng(latitude,longitude); 
				setMarkerPosition(marker,latitude,longitude);
				coords[spi]=position;
				flightPath.setPath(ordv());
				coordst[spi]={x:latitude,y:longitude };
				if(force){
					console.log(force);
					localisation_gps.value=latitude+","+longitude;
				}
			}
			function ordv(){
				var o=[];
				var gotten=false;
				for(var i in coords){
					if(coords[i]){
						if(!gotten){
							gotten=coords[i];
						}
						o.push(coords[i]);
					}
				}
				if(gotten){
					o.push(gotten)
				}
				return o;
			}
			function action(latitude,longitude){
				updatePosition(latitude,longitude);
				if(localisation_gps.value!=="" && spi==sps.length-1){
					addLine();
					setCurrent(spi+1);
				}
			}
		}
	}
	

		




}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCVSnOiY_GawHhgXZAufDXiYxnIqgtSdTQ &callback=map_element"></script>





